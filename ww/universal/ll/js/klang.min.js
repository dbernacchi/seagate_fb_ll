// fix for chrome looping bug affecting all versions of Klang.
(window.AudioContext = window.AudioContext || window.webkitAudioContext) && (function(){

  var browserInfo = (function () {

      var ua= navigator.userAgent;
      var temp;
      var match = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];

      if( /trident/i.test( match[ 1 ] ) ){
          temp =  /\brv[ :]+(\d+)/g.exec( ua ) || [];
          return {
              name: 'IE',
              version: temp [1] || 'unknown'
          };
      }

      if( match[ 1 ]=== 'Chrome' ){
          temp = ua.match(/\bOPR\/(\d+)/);

          if( temp !== null ) {
              return {
                  name: 'Opera',
                  version: temp[ 1 ]
              };
          }
      }

      match = match[ 2 ] ? [ match[ 1 ], match[ 2 ] ]: [ navigator.appName, navigator.appVersion, '-?' ];
      if( ( temp = ua.match( /version\/(\d+)/i ) ) !== null ) {
          match.splice( 1, 1, temp[ 1 ] );
      }

      return {
          name: match[0],
          version: match[1]
      };
  }());

  /**
   * Patch for Chrome 42+ looping bug
   * The bug occur when AudioBufferSourceNode.start is called with an explicit offset. This causes the loop to no longer work.
   */
  if ( browserInfo.name == 'Chrome' ){

      var AudioBufferSourceNodeProto = window.AudioBufferSourceNode.prototype;
      if ( !AudioBufferSourceNodeProto.internal_start ){
          AudioBufferSourceNodeProto.internal_start = AudioBufferSourceNodeProto.start;

          AudioBufferSourceNodeProto.start = function( when, offset, duration ){
              if ( this.loop ){
                  AudioBufferSourceNodeProto.internal_start.call( this, when );
              } else {
                  AudioBufferSourceNodeProto.internal_start.apply( this, arguments );
              }
          };
      }
  }
}());

if(-1!=navigator.userAgent.indexOf("MSIE")){var ie=!0,ua=navigator.userAgent,re=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),ieVersion;null!=re.exec(ua)&&(ieVersion=parseInt(RegExp.$1)),9>ieVersion&&(Object.oldDefineProperty=Object.defineProperty,Object.defineProperty=function(){})}var __extends=this.__extends||function(t,e){function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i},Klang;(function(t){function e(e){for(var i=[],n=0;arguments.length-1>n;n++)i[n]=arguments[n+1];if(y.isInited)try{if("webaudio"===t.version){if(!t.context)return;y.instance.triggerEvent(e,i)}}catch(s){t.err("Klang exception: unable to trigger event: '"+e+"'")}}function i(e,i,n){if(-1!=navigator.userAgent.indexOf("Firefox")?t.browser="Firefox":-1!=navigator.userAgent.indexOf("Chrome")?t.browser="Chrome":-1!=navigator.userAgent.indexOf("Safari")?t.browser="Safari":-1!=navigator.userAgent.indexOf("Opera")?t.browser="Opera":-1!=navigator.userAgent.indexOf("MSIE")&&(t.browser="IE"),t.isMobile=v.checkMobile(),t.isIOS=v.checkIOS(),t.klangInited)return t.warn("Klang already initialized"),void 0;if(t.klangInited=!0,void 0==window.AudioContext&&void 0!=window.webkitAudioContext&&(window.AudioContext=window.webkitAudioContext),void 0==window.AudioContext)return t.version="n/a",i(!1),!1;t.context||(t.context=new AudioContext);try{return t.version="webaudio",y.isInited()&&t.warn("Klang already initialized"),y.instance.loadJSON(e,i,n),!0}catch(s){return t.err("Klang exception: unable to parse config file: '"+e+"'"),t.version="failed web audio",i(!1),!1}}function n(){if("webaudio"==t.version)try{y.instance.initIOS()}catch(e){}}function s(e,i,n,s){try{t.logc("Klang: Loading: '"+e+"'",v.LOG_LOAD_COLOR),"webaudio"==t.version&&y.instance.loadSoundFiles(e,i,n,s)}catch(r){t.err("Klang exception: unable to load file group: '"+e+"'")}}function r(e){try{t.logc("Klang: Freeing: '"+e+"'",v.LOG_LOAD_COLOR),"webaudio"==t.version&&y.instance.freeSoundFiles(e)}catch(i){t.err("Klang exception: unable to free file group: '"+e+"'")}}function o(){return m.FileHandler.instance.progress}function a(){"webaudio"==t.version&&y.isInited()&&y.instance.stopAll()}function c(){for(var e=[],i=0;arguments.length-0>i;i++)e[i]=arguments[i+0];t.loggingEnabled&&("Chrome"==t.browser?console.log("%c["+f()+"] "+e.join(),"color:"+v.LOG_TIME_COLOR):console.log.apply(console,e))}function h(e,i){t.loggingEnabled&&("Chrome"==t.browser?(i||(i="gray"),console.log("%c["+f()+"] "+e,"color:"+i)):console.log(e))}function u(){for(var e=[],i=0;arguments.length-0>i;i++)e[i]=arguments[i+0];t.loggingEnabled&&("Chrome"==t.browser?console.warn("%c["+t.getTimeString()+"] "+e.join(),"color:"+v.LOG_WARN_COLOR):console.warn.apply(console,e))}function p(){for(var e=[],i=0;arguments.length-0>i;i++)e[i]=arguments[i+0];t.loggingEnabled&&("Chrome"==t.browser?console.warn("%c["+t.getTimeString()+"] "+e.join(),"color:"+v.LOG_ERROR_COLOR):console.warn.apply(console,e))}function l(t,e){for(var i=""+t;e>i.length;)i="0"+i;return i}function _(t){return l(t.getUTCMinutes(),2)+":"+l(t.getUTCSeconds(),2)+"."+l(t.getUTCMilliseconds(),3)}function f(e){void 0==e&&(e=t.context.currentTime);var i=Math.round(1e3*e),n=Math.floor(i/1e3%60),s=Math.floor(i/6e4%60),r=Math.floor(i/36e5%24);return l(r,2)+":"+l(s,2)+":"+l(n,2)+"."+l(i%1e3,3)}function d(){return"flash"===t.version?null:"audiotag"==t.version?t.audioTagHandler._events:y.instance._eventTable}function g(){t.klangInited=!1,"webaudio"==t.version&&y.isInited()&&(y.instance.stopAll(),y.deinit()),t.version="n/a"}t.versionNumber=2,t.context,t.version,t.safari,t.progressCallback,t.readyCallback,t.browser,t.os,t.isMobile,t.isIOS,t.fallback,t.loggingEnabled=!1,t.useMonoBuffers=!1,t.Panner;var y=function(){function e(){this._initComplete=!1,this._blurFadeOut=!1,t.safari=void 0==t.context.createGain,this._preLoadInitStack=[],this._postLoadInitStack=[],this._connectStack=[],this._superMasterOutput=t.safari?t.context.createGainNode():t.context.createGain(),t.Panner=m.Panner,v.getParameterByName("klang_log")&&(t.loggingEnabled=!0)}return e.inst=null,e.isInited=function(){return null==e.inst?!1:e.inst._initComplete},Object.defineProperty(e.prototype,"initComplete",{get:function(){return this._initComplete},enumerable:!0,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return null==e.inst&&(e.inst=new e),e.inst},enumerable:!0,configurable:!0}),e.deinit=function(){e.inst=null},e.prototype.stopAll=function(){window.removeEventListener("focus",this._focusFunction),window.removeEventListener("blur",this._blurFunction);for(var t in this._objectTable)if(this._objectTable[t].stop)try{this._objectTable[t].stop()}catch(e){}},e.prototype.loadJSON=function(t,i,n){if(this._readyCallback=i,this._progressCallback=n||function(){},"object"==typeof t){var s=this.createConfigNode(t);e.settings=s.settings,e.instance.initContent(s)}else{if("string"!=typeof t)throw"Klang exception: unrecognized options: '"+t+"'";var r=new XMLHttpRequest;r.open("GET",t,!0);var o=this;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var i=r.responseText,n=o.parseConfigJSON(i);e.settings=n.settings,e.instance.initContent(n,null,t)}else{if(404==r.status)throw"Klang exception: config file not found: '"+t+"'";if(200!=r.status)throw"Klang exception: unable to load config file: '"+t+"'"}},r.send(null)}},e.prototype.parseConfigJSON=function(t){return JSON.parse(t,function(t,e){return e&&"object"==typeof e&&"string"==typeof e.type?new m[e.type](e,t):e})},e.prototype.createConfigNode=function(t){if("object"==typeof t)for(var e in t){var i=t[e];"object"==typeof i&&"string"==typeof i.type?(t[e]=this.createConfigNode(i),t[e]=new m[i.type](i,e)):t[e]=this.createConfigNode(i)}return t},e.prototype.initContent=function(i,n,s){var r,o=i.settings.relative_path,a=i.settings.file_path||"";if(o?-1!=s.lastIndexOf("/")?(r=s.substring(0,s.lastIndexOf("/")),"/"!==r.charAt(r.length-1)&&(r+="/"),r+=a):r=a:r=a,-1!=i.settings.blur_fade_time){this._blurFadeOut=!0;var c=i.settings.blur_fade_time||.5,h=this;window.addEventListener("focus",function(){v.curveParamLin(h._superMasterOutput.gain,1,c)}),window.addEventListener("pageshow",function(){v.curveParamLin(h._superMasterOutput.gain,1,c)}),window.addEventListener("blur",function(){h._blurFadeOut&&v.curveParamLin(h._superMasterOutput.gain,0,c)}),window.addEventListener("pagehide",function(){h._blurFadeOut&&v.curveParamLin(h._superMasterOutput.gain,0,c)})}m.FileHandler.instance.fileInfo=(void 0!=n?n:i.files)||[],this._eventTable=i.events||{},this._objectTable={};for(var u in i.audio)this._objectTable[u]=i.audio[u];for(var u in i.busses)this._objectTable[u]=i.busses[u];for(var u in i.sequencers)this._objectTable[u]=i.sequencers[u];for(var u in i.processes)this._objectTable[u]=i.processes[u];for(var u in i.synths)this._objectTable[u]=i.synths[u];for(var u in i.lfos)this._objectTable[u]=i.lfos[u];for(var u in i.automations)this._objectTable[u]=i.automations[u];if(i.vars){for(var p in i.vars)if("string"==typeof i.vars[p]&&i.vars[p].indexOf("me.")>-1)i.vars[p]=this.findInstance(i.vars[p].split("me.")[1]);else if("object"==typeof i.vars[p]){var l=i.vars[p];for(var _ in l)l.hasOwnProperty(_)&&"string"==typeof l[_]&&l[_].indexOf("me.")>-1&&(l[_]=this.findInstance(l[_].split("me.")[1]))}v.vars=i.vars}m.Panner.setListenerData(i.settings.listener),v.createCurves(i.curves);for(var f=0,d=this._preLoadInitStack.length;d>f;f++){var g=this._preLoadInitStack[f];g.init&&g.init()}this._superMasterOutput.connect(t.context.destination);for(var f=0,d=this._connectStack.length;d>f;f++){var g=this._connectStack[f];switch(g.destinationName){case"$OUT":g.connect(this._superMasterOutput);break;case"$PARENT":break;default:var y=this.findInstance(g.destinationName);g.connect(y.input)}}this._preLoadInitStack=null,this._connectStack=null,this._timeHandler=new m.TimeHandler,this._initComplete=!0,m.FileHandler.instance.baseURL=r,m.FileHandler.instance.loadFiles("auto",e.soundsLoaded,this._progressCallback)},e.prototype.loadSoundFiles=function(t,e,i,n){i&&(this._progressCallback=i),m.FileHandler.instance.loadFiles(t,e,this._progressCallback,n)},e.prototype.freeSoundFiles=function(t){m.FileHandler.instance.freeSoundFiles(t);for(var e in this._objectTable){var i=this._objectTable[e];if("AudioSource"==i._type){var n=m.FileHandler.instance.getFileInfo(i._fileId);n&&n.load_group==t&&i.freeBuffer()}}},e.soundsLoaded=function(){for(var t=e.instance,i=0,n=t._postLoadInitStack.length;n>i;i++)t._postLoadInitStack[i].init();t._postLoadInitStack=null,t._readyCallback&&t._readyCallback(!0)},e.prototype.pushToPreLoadInitStack=function(t){return this._preLoadInitStack?(this._preLoadInitStack.push(t),!0):!1},e.prototype.pushToPostLoadInitStack=function(t){return this._postLoadInitStack?(this._postLoadInitStack.push(t),!0):!1},e.prototype.pushToConnectStack=function(t){return this._connectStack?(this._connectStack.push(t),!0):!1},e.prototype.findInstance=function(t){var e=this._objectTable[t];return e},e.prototype.triggerEvent=function(t){for(var e=[],i=0;arguments.length-1>i;i++)e[i]=arguments[i+1];v.lastEvent=t;var n=this._eventTable[t];if("string"==typeof n)this._objectTable[n].start(e[0]);else if(n instanceof Array)for(var s=0,r=n.length;r>s;s++)this._objectTable[n[s]].start(e[0])},e.prototype.initIOS=function(){var e=t.context.createBufferSource();t.safari?e.noteOn(0):e.start(0)},Object.defineProperty(e.prototype,"timeHandler",{get:function(){return this._timeHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._superMasterOutput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurFadeOut",{get:function(){return this._blurFadeOut},set:function(t){this._blurFadeOut=t},enumerable:!0,configurable:!0}),e}();t.klangInited=!1,t.triggerEvent=e,t.init=i,t.initIOS=n,t.load=s,t.free=r,t.getLoadProgress=o,t.stopAll=a,t.log=c,t.logc=h,t.warn=u,t.err=p,t.zeropad=l,t.getTimeStamp=_,t.getTimeString=f,t.getEvents=d,t.deinit=g;var m;(function(e){function i(t,e,i,n,s){s===void 0&&(s="linear");var r,o;if("linear"==s)r=function(t){return 1-t},o=function(t){return t};else{if("equalpower"!=s)return;r=function(t){return Math.pow(1-t,.5)},o=function(t){return Math.pow(t,.5)}}i=Math.min(i,t.length),n=Math.min(n,e);for(var a=0;t.numberOfChannels>a;a++){for(var c=t.getChannelData(a),h=i-1,u=e-1,p=n-1;p>=0;p--){var l=(p+1)/(n+1);c[h]=c[h]*r(l)+c[u]*o(l),h--,u--}for(var _=i,f=e;t.length>_;)c[_++]=c[f++]}}function n(e,i){var n=e||65536,s=t.context.createBuffer(1,n,t.context.sampleRate),r=s.getChannelData(0);i||(i=0);for(var o=0;n>o;o++)switch(i){case 0:r[o]=2*Math.random()-1;break;case 1:r[o]=Math.random();break;case 2:r[o]=Math.random()-1;break;case 3:r[o]=o/n;break;default:}return s}var s=function(){function e(){this._files={},this._groups={},this._lastSentPercent=-1}return e.inst=null,Object.defineProperty(e,"instance",{get:function(){return null==e.inst&&(e.inst=new e),e.inst},enumerable:!0,configurable:!0}),e.prototype.sendProgressCallback=function(t){if(this._groups[t].progressCallback&&!this._groups[t].loadInterrupted){var e=0;this._groups[t].progress.readyAudioFiles>=this._groups[t].progress.totalAudioFiles&&(e=Math.floor(100*((this._groups[t].progress.loadedBytes+this._groups[t].progress.bufferedFiles)/(this._groups[t].progress.totalBytes+this._groups[t].progress.totalFiles)))),this._lastSentPercent=e,this._groups[t].progressCallback(e)}},e.prototype.updateProgress=function(t,e){var i=t.load_group;if(!t.sizeReceived){t.sizeReceived=!0;var n=1;e.lengthComputable&&(n=e.total,t.loadedBytes=0),t.totalBytes=n,this._groups[i].progress.totalBytes+=n,this._groups[i].progress.readyAudioFiles++}if(void 0!=t.loadedBytes){var s=e.loaded-t.loadedBytes;t.loadedBytes=e.loaded,this._groups[i].progress.loadedBytes+=s,this.sendProgressCallback(i)}},e.prototype.loadAudioBuffer=function(e,i){var n=this,s=new XMLHttpRequest,r=".ogg";"Safari"===t.browser&&(r=".mp3"),s.open("GET",this._baseURL+e.url+r,!0),s.responseType="arraybuffer",s.sizeReceived=!1,s.load_group=e.load_group,s.onprogress=function(t){n.updateProgress(s,t)},s.onload=function(){t.context.decodeAudioData(s.response,function(r){if(s.loadedBytes){var o=s.totalBytes-s.loadedBytes;n._groups[e.load_group].progress.loadedBytes+=o}else n._groups[e.load_group].progress.loadedBytes+=1;if(t.useMonoBuffers){for(var a=r.length,c=t.context.createBuffer(1,a,t.context.sampleRate),h=r.getChannelData(0),u=c.getChannelData(0),p=0;a>p;p++)u[p]=h[p];r=c}n.addFile(e,r),i&&i(),r=null,s=null},function(){console.log("Klang warning: unable to load file '"+(this._baseURL||"")+e.url+"'")}),s.response=null},s.onreadystatechange=function(){4==s.readyState&&200==s.status||200!=s.status&&(n._groups[e.load_group].loadInterrupted=!0,n._groups[e.load_group].loadFailedCallback&&n._groups[e.load_group].loadFailedCallback())},s.send(),this._groups[e.load_group].progress.totalAudioFiles++},e.prototype.loadMidiFile=function(t,e){var i=this;loadRemote(this._baseURL+t.url,function(t,e){i.updateProgress(t,e)},function(n){i.addFile(t,readMidiFile(n)),e&&e()})},e.prototype.loadMidiString=function(t){var e=this,i=new XMLHttpRequest;i.open("GET",this._baseURL+t.url),i.onprogress=function(t){e.updateProgress(i,t)},i.onreadystatechange=function(){4==this.readyState&&200==this.status&&e.addFile(t,readMidiString(i.response))},i.send()},e.prototype.loadFiles=function(t,e,i,n){"string"==typeof t&&(t=[t]);for(var s=0,r=t.length;r>s;s++)this._groups[t[s]]={},this._groups[t[s]].filesLoadedCallback=e,this._groups[t[s]].progressCallback=i,this._groups[t[s]].loadFailedCallback=n,this._groups[t[s]].loadInterrupted=!1,this._groups[t[s]].progress={totalBytes:0,loadedBytes:0,totalFiles:0,totalAudioFiles:0,readyAudioFiles:0,bufferedFiles:0};for(var s=0,r=this._fileInfo.length;r>s;s++){var o=this._fileInfo[s],a=t.indexOf(o.load_group);if(-1!=a&&!this._files[o.id]&&!o.only_audio_tag){switch(o.file_type){case"audio":this.loadAudioBuffer(o);break;case"midi":this.loadMidiFile(o);break;case"midistring":this.loadMidiString(o)}this._groups[t[a]].progress.totalFiles++}}for(var s=0,r=t.length;r>s;s++)0==this._groups[t[s]].progress.totalFiles&&this._groups[t[s]].filesLoadedCallback&&!this._groups[t[s]]._loadInterrupted&&this._groups[t[s]].filesLoadedCallback(!0)},e.prototype.addFile=function(t,e){this._files[t.id]=e,this._groups[t.load_group].progress.bufferedFiles++,this.sendProgressCallback(t.load_group),this._groups[t.load_group].progress.bufferedFiles!=this._groups[t.load_group].progress.totalFiles||this._groups[t.load_group].loadInterrupted||this._groups[t.load_group].filesLoadedCallback&&this._groups[t.load_group].filesLoadedCallback(!0)},e.prototype.freeSoundFiles=function(t){"string"==typeof t&&(t=[t]);for(var e=0,i=this._fileInfo.length;i>e;e++){var n=this._fileInfo[e];-1!=t.indexOf(n.load_group)&&(this._files[n.id]=null)}},e.prototype.getFile=function(t){return this._files[t]||null},e.prototype.getFileInfo=function(t){for(var e=0,i=this._fileInfo.length;i>e;e++)if(this._fileInfo[e].id==t)return this._fileInfo[e];return void 0},Object.defineProperty(e.prototype,"progress",{get:function(){return this._groups},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseURL",{set:function(t){this._baseURL=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fileInfo",{set:function(t){this._fileInfo=t},enumerable:!0,configurable:!0}),e}();e.FileHandler=s;var r=function(){function e(e,i){this._name=i,this._type=e.type,this._output=t.safari?t.context.createGainNode():t.context.createGain(),this._volume=void 0!=e.volume?e.volume:1,this._output.gain.value=this._volume,e.destination_name&&(this.destinationName=e.destination_name,y.instance.initComplete||y.instance.pushToConnectStack(this))}return e.prototype.connect=function(){return this},e.prototype.disconnect=function(){return this},e.prototype.play=function(){return this},e.prototype.stop=function(){return this},e.prototype.pause=function(){return this},e.prototype.unpause=function(){return this},e.prototype.curvePlaybackRate=function(){return this},e.prototype.fadeInAndPlay=function(){return this},e.prototype.fadeOutAndStop=function(){return this},e.prototype.deschedule=function(){return this},Object.defineProperty(e.prototype,"playbackRate",{set:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._output},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playbackState",{get:function(){return 0},enumerable:!0,configurable:!0}),e}();e.Audio=r;var o=function(e){function n(t,i){if(e.call(this,t,i),this._sources=[],this._startTime=0,this._loopStartTime=0,this._scheduleAhead=.2,this._stopping=!1,this._fading=!1,this._paused=!1,this._pauseTime=-1,this._pauseStartTime=-1,this.data=t,this._fileId=t.file_id,this._playbackRate=t.playback_rate||1,this._endTime=0,this._loop=void 0!=t.loop?t.loop:!1,this._loopStart=t.loop_start,this._loopEnd=t.loop_end,this._offset=t.offset||0,this._duration=t.duration||0,this._reverse=t.reverse,this._retrig=void 0!=t.retrig?t.retrig:!0,this._lockPlaybackrate=void 0!=t.lock_playback_rate?t.lock_playback_rate:!1,t.panner&&(this._panner=t.panner),t.granular){this._granular={bufferDuration:0,speed:t.granular.speed||.3333,pitch:t.granular.pitch||0,pitchRandomization:t.granular.pitch_randomization||0,timeRandomization:t.granular.time_randomization||0,realTime:0,grainTime:0,grainDuration:t.granular.grain_duration||.09,grainSpacing:t.granular.grain_spacing||.045,grainWindow:null};var n=16384;this._granular.grainWindow=new Float32Array(n);for(var s=0;n>s;++s)this._granular.grainWindow[s]=Math.sin(Math.PI*s/n)}y.instance.pushToPostLoadInitStack(this)||this.init()}return __extends(n,e),n.prototype.init=function(){if(this._buffer=s.instance.getFile(this._fileId),this._buffer){if(this._duration||(this._duration=this._buffer.duration),this._granular&&(this._granular.bufferDuration=this._buffer.duration-.05),this._reverse){for(var e=t.context.createBuffer(this._buffer.numberOfChannels,this._buffer.length,t.context.sampleRate),n=0;this._buffer.numberOfChannels>n;n++)for(var r=this._buffer.getChannelData(n),o=e.getChannelData(n),a=r.length,c=a-1;c>=0;c--)o[a-c]=r[c];this._buffer=e}if(this.data.xfade){var h=t.context.sampleRate,u=this.data.xfade===!0?11025:this.data.xfade*h,p=void 0==this._loopStart?u:Math.round(this._loopStart*h),l=void 0==this._loopEnd?this._buffer.length:Math.round(this._loopEnd*h);i(this._buffer,p,l,u)}}},n.prototype.setLoopRegion=function(t,e){this._loopStart=t||this._loopStart,this._loopEnd=e||this._loopEnd;for(var i=0,n=this._sources.length;n>i;i++){var s=this._sources[i];s.loopStart=this._loopStart,s.loopEnd=this._loopEnd}return this},n.prototype.connect=function(t,e){return(!this._destination||e)&&(this._destination=t,this._panner?(this._output.connect(this._panner.input),this._panner.output.connect(t)):this._output.connect(t)),this},n.prototype.disconnect=function(){return this._output.disconnect(),this._destination=null,this._panner&&this._panner.output.disconnect(),this},n.prototype.scheduleGrain=function(){if(this._buffer){var e=this._granular,i=t.context.createBufferSource();i.buffer=this._buffer;var n=Math.random(),s=Math.random(),r=Math.random(),o=Math.random();Math.random(),n=2*(n-.5),s=2*(s-.5),r=2*(r-.5),o=2*(o-.5);var a=t.context.createGain();i.connect(a),a.connect(this._output);var c=this._granular.pitch+n*e.pitchRandomization,h=Math.pow(2,c/1200);i.playbackRate.value=h;var u=s*e.timeRandomization;i.noteGrainOn(e.realTime,e.grainTime+u,e.grainDuration);var p=e.grainDuration/h;a.gain.value=0,a.gain.setValueCurveAtTime(e.grainWindow,e.realTime,p),e.grainTime,e.realTime+=e.grainSpacing,e.grainTime+=e.speed*e.grainSpacing,e.grainTime>e.bufferDuration&&(e.grainTime=0,this._loop||this.stop()),0>e.grainTime&&(e.grainTime+=e.bufferDuration,this._loop||this.stop())}},n.prototype.granularSchedule=function(e){for(;e+.1>this._granular.realTime;)this.scheduleGrain();var i=this;this._granular.scheduleId=setTimeout(function(){i.granularSchedule(t.context.currentTime)},20)},n.prototype.play=function(e,i,n){if(e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=!1),this.removeUnusedSources(),this._buffer||(this.init(),this._buffer)){if(e=e||0,this._granular)this.granularSchedule(e);else{if(0!=e&&t.context.currentTime>=e+.01)return this;if(0==e&&(e=t.context.currentTime),this.output.gain.cancelScheduledValues(e),this.output.gain.setValueAtTime(this._volume,e),this.paused||(this._pauseStartTime=e),n||(this._pauseTime=0),this._startTime=e,this._loopStartTime=e+this.duration,this._paused=!1,this._stopping)return this.output.gain.cancelScheduledValues(e),this.output.gain.setValueAtTime(this.output.gain.value,e),this.output.gain.linearRampToValueAtTime(this._volume,e+.25),clearTimeout(this._stoppingId),this._stopping=!1,void 0;if(this._fading||(this.output.gain.value=this._volume),this._fading=!1,this._retrig||this.loop){if(this.loop&&(-1==this._endTime||this._endTime>e))return}else if(this._endTime>e)return;this._endTime=this.loop?-1:e+this._buffer.duration;var s=this.createBufferSource();s.buffer=this._buffer,this._loop&&(s.loop=!0,s.loopStart=this._loopStart?this._loopStart:0,s.loopEnd=this._loopEnd?this._loopEnd:this._buffer.duration),s.connect(this._output),i>this._duration&&(i%=this._duration),this._startOffset=this._offset+i;var r=this._duration;s.startTime=e,t.safari?s.noteGrainOn(e,this._startOffset,(r||s.buffer.duration)-this._startOffset):s.start(e,this._startOffset,r||s.buffer.duration)}return this}},n.prototype.getNumberOfSamples=function(){return this._buffer.length},n.prototype.stop=function(e){if(e===void 0&&(e=0),this._granular)clearTimeout(this._granular.scheduleId);else{this._stopping&&(this._stopping=!1,clearTimeout(this._stoppingId));var i=this._sources.length;if(i>0){e=e||v.now(),this._endTime=this._loop?e:e;for(var n=0;i>n;n++){var s=this._sources[n];t.safari?s.noteOff(e):s.stop(e)}this._sources=[]}else this._loopPlaying=!1}return this},n.prototype.deschedule=function(){for(var e=0;this._sources.length>e;e++){var i=this._sources[e];i.startTime>t.context.currentTime&&(t.safari?i.noteOff(0):(console.log("source stop"),i.stop(0)),this._sources[e].disconnect(),i.disconnect(),this._sources.splice(e,1),e--)}return this},n.prototype.pause=function(){if(this._endTime>v.now()){this._paused=!0;var t=v.now()-this._startTime;this._pauseTime+=t,this.stop()}return this},n.prototype.unpause=function(){if(this.paused){var t=this._offset;this._offset+=this._pauseTime,this.play(0,0,!0),this._offset=t}return this},n.prototype.createBufferSource=function(){var e=t.context.createBufferSource();return e.playbackRate.value=this._playbackRate,this._sources.push(e),e},n.prototype.fadeInAndPlay=function(e,i,n){n===void 0&&(n=0);var s=t.context.currentTime;return i||(i=s),this.loop&&(-1==this._endTime||this._endTime>i)&&!this._stopping?void 0:(this.output.gain.cancelScheduledValues(i),this._stopping?(clearTimeout(this._stoppingId),this.output.gain.setValueAtTime(this.output.gain.value,i)):(this._fading=!0,this.play(i==s?0:i,n),this.output.gain.setValueAtTime(0,i)),this._stopping=!1,this.output.gain.linearRampToValueAtTime(this._volume,i+e),this)},n.prototype.fadeOutAndStop=function(e,i){if(this.playing){void 0==i&&(i=t.context.currentTime),this._stopping&&clearTimeout(this._stoppingId),this.output.gain.cancelScheduledValues(i),this.output.gain.setValueAtTime(this.output.gain.value||this._volume,i),this.output.gain.linearRampToValueAtTime(0,i+e);var n=this;return this._stopping=!0,this._stoppingId=setTimeout(function(){n._stopping=!1,n.loop&&(n._loopPlaying=!1),n.stop(i+e)},(e+(i-v.now())-n._scheduleAhead)/.001),this}},n.prototype.removeUnusedSources=function(){for(var e=0;this._sources.length>e;e++){var i=this._sources[e];(3==i.playbackState||!i.buffer||i.startTime+i.buffer.duration<t.context.currentTime)&&(this._sources[e].disconnect(),this._sources.splice(e,1),e--)}},n.prototype.curvePlaybackRate=function(t,e){if(!this._lockPlaybackrate){var i=this.playbackRateNode;return i.cancelScheduledValues(v.now()),i.setValueAtTime(0==i.value?v.EXP_MIN_VALUE:i.value,v.now()),i.exponentialRampToValueAtTime(t,v.now()+e),this.playbackRate=t,this}},Object.defineProperty(n.prototype,"lastSource",{get:function(){var t=this._sources.length;return 0==t?null:this._sources[t-1]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"offset",{get:function(){return this._offset},set:function(t){this._offset=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"position",{get:function(){if(!this.playing||!this._duration)return 0;var t=this._duration;(this._loopStart||this._loopEnd)&&(t=(this._loopEnd||t)-(this._loopStart||0));var e=v.now()-this._startTime,i=v.now()+this._startOffset-this._loopStartTime;return this._startOffset+e>this._duration?this._loopStart+i%t:this._startOffset+e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){if(!this._lockPlaybackrate){this._playbackRate=t;for(var e=0,i=this._sources.length;i>e;e++)this._sources[e].playbackRate.value=this._playbackRate}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nextPlaybackRate",{set:function(t){this._lockPlaybackrate||(this._playbackRate=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"playbackRateNode",{get:function(){var t=this.lastSource;return t&&3!==t.playbackState||(t=this.createBufferSource()),t.playbackRate},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buffer",{get:function(){return this._buffer||(this._buffer=s.instance.getFile(this._fileId)),this._buffer},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"playing",{get:function(){return-1==this._endTime||this._endTime>v.now()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"playbackState",{get:function(){var t=this.lastSource;return t?t.playbackState:0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"output",{get:function(){return this._panner?this._panner.output:this._output},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"panner",{get:function(){return this._panner},enumerable:!0,configurable:!0}),n.prototype.freeBuffer=function(){this._buffer=null;for(var t=0,e=this._sources.length;e>t;t++){try{this._sources[t].stop(0)}catch(i){}this._sources[t].disconnect(),this._sources[t]=null}this._sources=[]},n}(r);e.AudioSource=o,e.crossfade=i;var a={CONCURRENT:0,STEP:1,RANDOM:2,SHUFFLE:3,BACKWARDS:4},c={NONE:0,ONE:1,INFINITE:2},h=function(e){function i(t,i){e.call(this,t,i),this._adder=0,this._currentId=0,this._paused=!1,this._groupType=void 0!=t.group_type?t.group_type:a.STEP,this._retrig=void 0!=t.retrig?t.retrig:!0,this._queue=void 0!=t.queue?t.queue:c.NONE,this._content=t.content||[],y.instance.pushToPreLoadInitStack(this)}return __extends(i,e),i.prototype.init=function(){for(var t=[],e=0,i=this._content.length;i>e;e++)t.push(y.instance.findInstance(this._content[e]));this._content=t},i.prototype.connect=function(t){for(var e=0,i=this._content.length;i>e;e++){var n=this._content[e];n.disconnect(),n.connect(this._output)}return this._output.connect(t),this},i.prototype.disconnect=function(){return this._output.disconnect(),this},i.prototype.play=function(e,i,n){if(this._content.length){var s=this.latestPlayed?this.latestPlayed.playing:!1;if(!n&&!this._retrig&&s)return this._queue!=c.NONE&&(this._queue==c.ONE&&this._latestStartTime>t.context.currentTime?(this.latestPlayed.stop(),this.play(this._latestStartTime,i,!0)):this.play(this._latestStartTime+this.latestPlayed.duration,i,!0)),this;if(this._paused=!1,void 0!=i){var r;"number"==typeof i?r=i:"string"==typeof i?r=this.getIdFromString(i):i._name&&(r=this.getIdFromString(i._name)),this._content[r].play(e),this._latestPlayed=this._content[r]}else{if(this._groupType==a.STEP)this._currentId=0>this._adder?this._content.length-1+this._adder%this._content.length:this._adder%this._content.length,this._adder++,this._content[this._currentId].play(e);else if(this._groupType==a.RANDOM){var o=Math.floor(Math.random()*(this._content.length-1));this._content.length>1&&o==this._adder&&(o=(o+1)%this._content.length),this._currentId=this._adder=o,this._content[this._currentId].play(e)}else if(this._groupType==a.SHUFFLE)0==this._adder%this._content.length&&v.shuffle(this._content),this._currentId=this._adder%this._content.length,this._adder++,this._content[this._currentId].play(e);else if(this._groupType==a.CONCURRENT)for(var h=0,u=this._content.length;u>h;h++)this._content[h].play(e);else this._groupType==a.BACKWARDS&&(this._currentId=0>this._adder?this._content.length-1+this._adder%this._content.length:this._adder%this._content.length,this._adder--,this._content[this._currentId].play(e));this._latestPlayed=this._groupType===a.CONCURRENT?this._content[0]:this._content[this._currentId]}return this._latestStartTime=e||t.context.currentTime,this}},i.prototype.stop=function(t){return this._content[this._currentId].stop(t),this},i.prototype.pause=function(){return this._paused=!0,this._latestPlayed&&this._latestPlayed.pause(),this},i.prototype.unpause=function(){return this._paused=!1,this._latestPlayed&&this._latestPlayed.unpause(),this},i.prototype.fadeInAndPlay=function(t,e){return this.play(e),this.output.gain.value=0,v.curveParamLin(this.output.gain,1,t,e),this},i.prototype.fadeOutAndStop=function(e,i){return void 0==i&&(i=t.context.currentTime),this.output.gain.cancelScheduledValues(i),v.curveParamLin(this.output.gain,0,e,i),v.setParam(this.output.gain,this._volume,i+e),this.stop(i+e),this},i.prototype.curvePlaybackRate=function(t,e){for(var i=0,n=this._content.length;n>i;i++)this._content[i].curvePlaybackRate(t,e);return this},i.prototype.deschedule=function(){for(var t=0,e=this._content.length;e>t;t++)this._content[t].deschedule();return this},i.prototype.getIdFromString=function(t){for(var e=0,i=this._content.length;i>e;e++)if(this._content[e]._name==t)return e},Object.defineProperty(i.prototype,"playbackRate",{set:function(t){for(var e=0,i=this._content.length;i>e;e++)this._content[e].playbackRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"groupType",{get:function(){return this._groupType},set:function(t){this._groupType=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"content",{get:function(){return this._content},set:function(t){this._content=t,this.init()},enumerable:!0,configurable:!0}),i.prototype.addContent=function(t){this._content.push(t)},i.prototype.removeContent=function(t){for(var e=0;this._content.length>e;e++)this._content[e]._name===t&&this._content.splice(e,1)},Object.defineProperty(i.prototype,"playing",{get:function(){return this._latestPlayed?this._latestPlayed.playing:!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._latestPlayed?this._latestPlayed.duration:this._content[0].duration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playbackState",{get:function(){return this._content[this._currentId].playbackState},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"latestPlayed",{get:function(){return this._latestPlayed},enumerable:!0,configurable:!0}),i}(r);e.AudioGroup=h;var u=function(){function e(t){this._startValue=t.start_value||0,this._points=t.points||[]
}return e.prototype.automate=function(e,i){i=i||t.context.currentTime,e.cancelScheduledValues(i),e.setValueAtTime(this._startValue,i);for(var n=0,s=0,r=this._points.length;r>s;s++){var o=this._points[s];switch(o.curve){case"lin":e.linearRampToValueAtTime(o.value,i+o.time);break;case"exp":e.exponentialRampToValueAtTime(o.value,i+o.time);break;default:e.setValueCurveAtTime(v.CUSTOM_CURVES[o.curve],i+n,o.time-n)}n=o.time}},e}();e.Automation=u;var p=function(){function e(e,i){this._name=i,this._type=e.type,this._input=t.safari?t.context.createGainNode():t.context.createGain(),this._output=t.safari?t.context.createGainNode():t.context.createGain(),this._effects=e.effects||[];for(var n=0,s=this._effects.length;s>n;n++)e.effects[n].active===!1&&this._effects[n].setActive(!1);this._input.gain.value=void 0!==e.input_vol?e.input_vol:1,this._output.gain.value=void 0!==e.output_vol?e.output_vol:1,e.destination_name&&(this.destinationName=e.destination_name,y.instance.pushToConnectStack(this)),y.instance.pushToPreLoadInitStack(this)}return e.prototype.init=function(){for(var t=this._input,e=0,i=this._effects.length;i>e;e++)t.disconnect(),t.connect(this._effects[e].input),t=this._effects[e];t.connect(this._output)},e.prototype.connect=function(t){return this._output.connect(t),this},e.prototype.disconnect=function(){return this._output.disconnect(),this},Object.defineProperty(e.prototype,"input",{get:function(){return this._input},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._output},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effects",{get:function(){return this._effects},enumerable:!0,configurable:!0}),e}();e.Bus=p;var l=function(e){function i(t,i){if(e.call(this,t,i),this._startStep=0,this._totalStep=0,this._currentStep=0,this._syncStep=0,this._stepCount=0,this._fadeTime=0,this._transpose=0,this._scales={diatonic:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0],dorian:[0,1,0,0,-1,0,1,0,1,0,0,-1],phrygian:[0,0,-1,0,-1,0,1,0,0,-1,0,-1],lydian:[0,1,0,1,0,1,0,0,1,0,1,0],mixolydian:[0,1,0,1,0,0,-1,0,-1,0,0,-1],aeolian:[0,-1,0,0,-1,0,-1,0,0,-1,0,-1],locrian:[0,0,-1,0,-1,0,0,-1,0,-1,0,-1],harmonicMinor:[0,1,0,0,-1,0,1,0,0,-1,1,0],melodicMinor:[0,1,0,0,-1,0,1,0,-1,0,1,0],majorPentatonic:[0,1,0,1,0,-1,1,0,1,0,-1,1],minorPentatonic:[0,-1,1,0,-1,0,1,0,-1,1,0,-1],doubleHarmonic:[0,0,-1,1,0,0,1,0,0,-1,1,0],halfDim:[0,1,0,0,-1,0,0,-1,0,-1,0,-1],chromatic:[0,0,0,0,0,0,0,0,0,0,0,0],custom:[0,0,0,0,0,0,0,0,0,0,0,0]},this._state=_.Stopped,this._beatSubscription=t.beat_subscription||.25,this._midiFileId=t.file_id,this._midiTrackIx=t.midi_track||0,this._sequencerName=t.sequencer,this._synthName=t.synth,this._loop=void 0!=t.loop?t.loop:!0,this._length=t.length||0,this._nextClip=0,this._startStep=t.start_step||0,this._root=t.root||0,this._transpose=this._orgTranspose=t.transpose||0,this._scale=this._orgScale=t.scale,this._rootNote=t.root_note||36,this._activeUpbeat=-1,t.upbeats){this._upbeats=[],this._upbeatLoopOffset=0;for(var n=0,s=t.upbeats.length;s>n;n++)this._upbeats.push({length:t.upbeats[n].length,step:t.upbeats[n].step,targetStep:t.upbeats[n].target_step,playInLoop:t.upbeats[n].play_in_loop})}y.instance.pushToPostLoadInitStack(this)}return __extends(i,e),i.prototype.init=function(){this._sequencer=y.instance.findInstance(this._sequencerName),this._sequencer.registerPattern(this),"progression"===this._synthName?(this._synth="progression",this._progression=!0,this._currentChord=[]):this._synth=y.instance.findInstance(this._synthName),this._midiFile=s.instance.getFile(this._midiFileId),this._midiFile&&this.setupFile()},i.prototype.setupFile=function(){this._midiTrack=this._midiFile.tracks[this._midiTrackIx],this.recalculateBPM(this._sequencer.bpm);var t=this._midiFile.header.ticksPerBeat,e=0;this._clips=[];for(var i=0,n=this._midiTrack.length;n>i;i++){var s=this._midiTrack[i];e+=s.deltaTime;var r=e/t%this._sequencer.resolution,o=e/t-r;this._clips.push({event:s,step:o,offset:e%(t*this._sequencer.resolution)})}return this},i.prototype.connect=function(t){return this._output.connect(t),this},i.prototype.disconnect=function(){return this._output.disconnect(),this},i.prototype.changeState=function(t){this._state=t},i.prototype.prePlaySchedule=function(t,e,i){if(!this._midiFile){if(this._midiFile=s.instance.getFile(this._midiFileId),!this._midiFile)return;this.setupFile()}if(i=i||!1,this._state==_.Playing){if(!i)return this;this._syncStep=e,this.stop(t,!0)}if(this._syncStep=e%this._length,this._currentStep=this._startStep,this.findNextClip(this._currentStep),t>0){if(this._stepCount=t,this._currentStep+=this._syncStep,this._syncStep=0,this._totalStep=0,this.changeState(_.PrePlaying),this._upbeats){this._activeUpbeat=-1;for(var n=0,r=this._upbeats.length;r>n;n++){var o=this._upbeats[n];t>=o.length&&(-1==this._activeUpbeat||this._upbeats[this._activeUpbeat].length<o.length)&&(this._activeUpbeat=n)}-1!=this._activeUpbeat&&this._upbeats[this._activeUpbeat].playInLoop&&(this._upbeatLoopOffset=this._upbeats[this._activeUpbeat].length)}this.findNextClip(-1==this._activeUpbeat?this._currentStep:this._upbeats[this._activeUpbeat].step)}else this.changeState(_.Playing);return this},i.prototype.play=function(t){if(!this._midiFile){if(this._midiFile=s.instance.getFile(this._midiFileId),!this._midiFile)return;this.setupFile()}if(this._state==_.Playing)return this;if(t&&0!=t){var e=this._output.gain.value;this._output.gain.setValueAtTime(0,0),this._output.gain.setValueAtTime(e,t)}return this._currentStep=this._sequencer.currentStep%this._length+this._startStep,this.changeState(_.Playing),this.findNextClip(this._currentStep),this._sequencer.started||this._sequencer.start(),this},i.prototype.restart=function(){return this._currentStep=this._startStep,this._nextClip=0,this},i.prototype.stop=function(t,e){return this._synth.deschedule&&this._sequencer._scheduleAheadTime>.5&&this._synth.deschedule(),void 0==t||this._state==_.Stopped?(this.changeState(_.Stopped),this):(void 0==e&&(e=!0),e?(this._stepCount=this._sequencer.getStepsToNext(this._sequencer.beatLength*t),this.changeState(_.PreStopping)):(this.changeState(_.Stopped),"progression"!==this._synth&&this._synth._loopedSamples&&this._synth.stop(t)),this)},i.prototype.pause=function(){return this},i.prototype.unpause=function(){return this},i.prototype.sendMidiEvents=function(t,e,i){for(var n=this._nextClip;this._clips[this._nextClip].step==t;){var s=this._clips[this._nextClip];if(this._progression){if("noteOn"===s.event.subtype)this._currentChord.push(s.event.noteNumber);else if("noteOff"===s.event.subtype){var r=this._currentChord.indexOf(s.event.noteNumber);r>-1&&this._currentChord.splice(r,1)}}else{var o=0;if(s.event.noteNumber){if(this._scale){var a=s.event.noteNumber,c=a%12-this._root;0>c&&(c+=12),o=this._scales[this._scale][c]}0!=this._transpose&&(o+=this._transpose)}i&&"noteOn"===s.event.subtype||this._synth.handleMidiEvent(s.event,e+s.offset*this._secPerTick,o)}if(this._nextClip++,this._nextClip==this._clips.length&&(this._nextClip=0),this._nextClip===n)break}if(this._progression&&this._currentChord.length){this._currentChord.sort(function(t,e){return t-e});var h=this._currentChord[0],u=h%12,o=0;u!=this._root&&(o=h-this._rootNote);for(var p=[0,0,0,0,0,0,0,0,0,0,0,0],l=[],_=0;this._currentChord.length>_;_++){var f=this._currentChord[_]%12-u;0>f&&(f+=12),l.push(f)}l.sort(function(t,e){return t-e});for(var d=0;p.length>d;d++){var g=this.getClosestValues(l,d);void 0!==g&&(p[d]=g-d)}this._sequencer.customScale=p,this._sequencer.transpose=o,this._rootNote=h}},i.prototype.getClosestValues=function(t,e){for(var i=-1,n=t.length;n-i>1;){var s=Math.round((i+n)/2);e>=t[s]?i=s:n=s}var r;return t[i]==e&&(r=n=i),r=Math.abs(e-n)>Math.abs(e-i)?i:Math.abs(e-n)<Math.abs(e-i)?n:i,t[r]},i.prototype.findNextClip=function(t){for(var e=0,i=this._clips.length;i>e;e++)if(this._clips[e].step>=t)return this._nextClip=e,e},i.prototype.playStep=function(t,e){var i=!0;this._currentStep>=this._length+this._startStep&&(this.sendMidiEvents(this._length,e,!0),this._currentStep=this._startStep,this.findNextClip(this._currentStep),this._loop||(this.changeState(_.Stopped),i=!1)),i&&this.sendMidiEvents(this._currentStep,e,!1),this._totalStep+=this._beatSubscription,this._currentStep+=this._beatSubscription},i.prototype.update=function(t,e){if(this._state!=_.Stopped&&0==t%this._beatSubscription)switch(this._upbeats&&-1!=this._activeUpbeat&&this._upbeats[this._activeUpbeat].playInLoop&&this._state==_.Playing&&this._currentStep>=this._length+this._startStep-this._upbeatLoopOffset&&(this._upbeatLoopOffset>0&&(this._stepCount=this._upbeatLoopOffset,this.changeState(_.PrePlaying)),this.sendMidiEvents(this._currentStep,e,!0),this._currentStep=this._startStep,this.findNextClip(this._upbeats[this._activeUpbeat].step)),this._state){case _.PrePlaying:if(-1!=this._activeUpbeat){var i=this._upbeats[this._activeUpbeat],n=i.length-this._stepCount;n>=0&&this.sendMidiEvents(i.step+n,e,!1)}this._stepCount-=this._beatSubscription,0>=this._stepCount&&(-1!=this._activeUpbeat&&i.targetStep&&(this._currentStep=i.targetStep),this.findNextClip(this._currentStep),this.changeState(_.Playing));break;case _.Playing:this.playStep(t,e);break;case _.PreStopping:this._stepCount-=this._beatSubscription,0>=this._stepCount?this.stop(e,!1):this.playStep(t,e);break;case _.PostStop:}return this},i.prototype.recalculateBPM=function(t){var e=this._midiFile.header.ticksPerBeat,i=6e7/t,n=i/1e6;this._secPerTick=n/e},i.prototype.getNextBar=function(t){var e=Math.ceil(this._currentStep/t);return this._currentStep>this._length-t&&(e=0),e},i.prototype.fadeInAndPlay=function(t,e){return this.play(e),this.output.gain.value=0,v.curveParamLin(this.output.gain,1,t,e),this},i.prototype.fadeOutAndStop=function(e,i){return void 0==i&&(i=t.context.currentTime),this.output.gain.cancelScheduledValues(i),v.curveParamLin(this.output.gain,0,e,i),v.setParam(this.output.gain,this._volume,i+e),this.stop(i+e),this},i.prototype.deschedule=function(t){if(void 0==t&&(t=this._length),this._synth.deschedule&&this._synth.deschedule(),this._state!=_.Stopped){if(t%=this._length,this._currentStep=this._currentStep-t,this._currentStep<this._startStep){var e=this._startStep-this._currentStep;this._currentStep=this._startStep+this._length-e}for(var i=0,n=this._clips.length;n>i;i++)if(this._clips[i].step>=this._currentStep){this._nextClip=i;break}console.log(this._name,"current",this._currentStep-this._startStep)}return this},i.prototype.resetTranspose=function(){this._transpose=this._orgTranspose},Object.defineProperty(i.prototype,"length",{get:function(){return this._length},set:function(t){this._length=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"startStep",{set:function(t){this._startStep=t,this._currentStep=this._sequencer.currentStep%this._length+this._startStep;for(var e=0,i=this._clips.length;i>e;e++)if(this._clips[e].step>=this._currentStep){this._nextClip=e;break}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{set:function(t){this._progression||(this._scale="reset"===t?this._orgScale:t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"customScale",{set:function(t){this._progression||(this._scales.custom=t,this._scale="custom")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transpose",{get:function(){return this._transpose},set:function(t){this._transpose=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"loop",{get:function(){return this._loop},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playing",{get:function(){var t=!1;return(1===this._state||1===this._state)&&(t=!0),t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._length*this._sequencer.getNoteTime(1)},enumerable:!0,configurable:!0}),i}(r);e.MidiPattern=l,function(t){t._map=[],t._map[0]="PrePlaying",t.PrePlaying=0,t._map[1]="Playing",t.Playing=1,t._map[2]="PreStopping",t.PreStopping=2,t._map[3]="PostStop",t.PostStop=3,t._map[4]="Stopped",t.Stopped=4}(e.PatternState||(e.PatternState={}));var _=e.PatternState,f=function(e){function i(t,i){e.call(this,t,i),this._startStep=0,this._totalStep=0,this._currentStep=0,this._syncStep=0,this._stepCount=0,this._fadeTime=0,this._length=2,this._loop=!0,this._tail=!1,this._forceFade=!1,this._activeUpbeat=-1,this._state=_.Stopped,this._beatSubscription=t.beat_subscription||.25,this._length=t.length||0,this._startStep=t.start_step||0,this._loop=void 0!=t.loop?t.loop:!0,this._tail=void 0!=t.tail?t.tail:!1,this._clips=[],this._upbeats=[],this._sequencerName=t.sequencer,this._initData={dummyClips:t.content,dummyUpbeats:t.upbeats},y.instance.pushToPreLoadInitStack(this)}return __extends(i,e),i.prototype.init=function(){if(this._initData.dummyClips)for(var t=0,e=this._initData.dummyClips.length;e>t;t++){var i=this._initData.dummyClips[t];i.audio?this._clips.push({audio:y.instance.findInstance(i.audio),process:null,args:null,step:i.step}):this._clips.push({audio:null,process:y.instance.findInstance(i.process),args:i.args,step:i.step})}if(this._initData.dummyUpbeats){for(var t=0,n=this._initData.dummyUpbeats.length;n>t;t++){for(var s=this._initData.dummyUpbeats[t],r=[],o=0,a=s.content.length;a>o;o++){var c=s.content[o];c.audio?r.push({audio:y.instance.findInstance(c.audio),process:null,args:null,step:c.step}):r.push({audio:null,process:y.instance.findInstance(c.process),args:c.args,step:c.step})}s.clips=r,this._upbeats.push({length:s.length,clips:r})}this._upbeats.sort(function(t,e){return e.length-t.length})}this._sequencer=y.instance.findInstance(this._sequencerName),this._sequencer.registerPattern(this),this._initData=null},i.prototype.connect=function(t){for(var e=0,i=this._clips.length;i>e;e++){var n=this._clips[e].audio;!n||n.destinationName&&"$PARENT"!=n.destinationName||(n.disconnect(),n.connect(this._output))}return this._output.connect(t),this},i.prototype.disconnect=function(){return this._output.disconnect(),this},i.prototype.changeState=function(t){this._state=t},i.prototype.prePlaySchedule=function(e,i,n,s,r){n=n||!1;var o=t.context.currentTime;if(this._state==_.PreStopping||this._state==_.PostStop)return this._output.gain.cancelScheduledValues(o),this._output.gain.setValueAtTime(this._output.gain.value,o),this._output.gain.linearRampToValueAtTime(this._volume,o+.5),this.changeState(_.Playing),clearTimeout(this._stoppingId),this;if(this._output.gain.value!=this._volume||_.Stopped){var a;a=this._state===_.Stopped&&s?0:this._output.gain.value,this._output.gain.cancelScheduledValues(o),this._output.gain.setValueAtTime(a,o),this._output.gain.linearRampToValueAtTime(this._volume,o+r)}else s&&(this._output.gain.cancelScheduledValues(o),this._output.gain.setValueAtTime(0,o),this._output.gain.linearRampToValueAtTime(this._volume,o+r));if(this._state==_.Playing||this._state==_.PrePlaying){if(!n)return this;this._syncStep=i,this.stop(e,!0,0)}if(this._syncStep=i%this._length+this._startStep,e>0||n){this._stepCount=e,this._currentStep=this._startStep,this._totalStep=0,this._activeUpbeat=-1;for(var c=0,h=this._upbeats.length;h>c;c++){var u=this._upbeats[c];e>=u.length&&(-1==this._activeUpbeat||this._upbeats[this._activeUpbeat].length<u.length)&&(this._activeUpbeat=c)}this.changeState(_.PrePlaying)}else this.changeState(_.Playing);return this},i.prototype.play=function(){return this._state==_.Playing||this._state==_.PrePlaying?this:((this._state==_.PreStopping||this._state==_.PostStop)&&clearTimeout(this._stoppingId),this._currentStep=this._sequencer.currentStep%this._length+this._startStep,this.changeState(_.Playing),this._sequencer.started||this._sequencer.start(),this)},i.prototype.stop=function(e,i,n,s){if(this._state==_.Stopped)return this;if(this._state===_.PrePlaying)return this.changeState(_.Stopped),void 0;if(void 0==e)return this.changeState(_.Stopped),this;if(void 0==i&&(i=!0),i)this._stepCount=this._sequencer.getStepsToNext(this._sequencer.beatLength*e)||0,this._fadeTime=n,this.changeState(_.PreStopping),s>0&&(this._stepCount+=s);else if(n){var r=n/this._sequencer.getNoteTime(1);this._stepCount=Math.ceil(r),this.changeState(_.PostStop);var o=e;this._output.gain.cancelScheduledValues(o),this._output.gain.setValueAtTime(this._output.gain.value,o),this._output.gain.linearRampToValueAtTime(0,o+n);var a=this;this._stoppingId=setTimeout(function(){for(var t=0;a._clips.length>t;t++)a._clips[t].audio&&a._clips[t].audio.stop(0)},(o-t.context.currentTime+n)/.001)}else this.changeState(_.Stopped);return this},i.prototype.pause=function(){for(var t=0,e=this._clips.length;e>t;t++)this._clips[t].audio&&this._clips[t].audio.pause();return this},i.prototype.unpause=function(){for(var t=0,e=this._clips.length;e>t;t++)this._clips[t].audio&&this._clips[t].audio.unpause();return this},i.prototype.playStep=function(t,e){this._currentStep>=this._length+this._startStep&&(this._loop?this._currentStep=this._startStep:this._loop||this.changeState(_.Stopped));for(var i=0,n=this._clips.length;n>i;i++)if(this._clips[i].step==this._currentStep){var s=this._clips[i];s.audio?s.audio.play(e):s.process.start(s.args)}this._totalStep+=this._beatSubscription,this._currentStep+=this._beatSubscription},i.prototype.update=function(t,e){if(this._state!=_.Stopped&&0==t%this._beatSubscription)switch(this._state){case _.PrePlaying:if(-1!=this._activeUpbeat)for(var i=this._upbeats[this._activeUpbeat],n=0,s=i.clips.length;s>n;n++){var r=i.clips[n];r.step==i.length-this._stepCount&&(r.audio?r.audio.play(e):r.process.start(r.args))}this._stepCount-=this._beatSubscription,0>=this._stepCount&&(this._currentStep=this._startStep+this._syncStep%this._length,this._syncStep=0,this.changeState(_.Playing));break;case _.Playing:this.playStep(t,e);break;case _.PreStopping:this._stepCount-=this._beatSubscription,0>=this._stepCount?!this._tail||this._forceFade?this.stop(e,!1,this._fadeTime):(this.changeState(_.Stopped),this._currentStep=0):this.playStep(t,e);break;case _.PostStop:this.playStep(t,e),this._stepCount-=this._beatSubscription,0>=this._stepCount&&(this._forceFade=!1,this.changeState(_.Stopped),this._currentStep=0)}return this},i.prototype.deschedule=function(t){if(void 0==t&&(t=this._length),this._state!=_.Stopped){t%=this._length;for(var e=0,i=this._clips.length;i>e;e++){var n=this._clips[e];n.audio&&n.audio.deschedule()}if(clearTimeout(this._stoppingId),this._output.gain.cancelScheduledValues(v.now()),this._currentStep=this._currentStep-t,this._currentStep<this._startStep){var s=this._startStep-this._currentStep;this._currentStep=this._startStep+this._length-s}}return this},i.prototype.fadeInAndPlay=function(){return this},i.prototype.fadeOutAndStop=function(t,e){return e=e||v.now(),this.stop(e,!1,t),this},i.prototype.curvePlaybackRate=function(t,e){for(var i=0,n=this._clips.length;n>i;i++)this._clips[i].audio.curvePlaybackRate(t,e);return this},i.prototype.getNextBar=function(t){var e=Math.ceil(this._currentStep/t);return this._currentStep>this._length-t&&(e=0),e},Object.defineProperty(i.prototype,"forceFade",{set:function(t){this._forceFade=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playbackRate",{set:function(t){for(var e=0,i=this._clips.length;i>e;e++)this._clips[e].audio.playbackRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"loop",{get:function(){return this._loop},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playing",{get:function(){var t=!1;return(1===this._state||1===this._state)&&(t=!0),t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._length*this._sequencer.getNoteTime(1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playbackState",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentStep",{get:function(){return this._currentStep},enumerable:!0,configurable:!0}),i}(r);e.Pattern=f;var d=function(){function e(e){this.active=!0,this._type=e.type,this._input=void 0!=t.context.createGain?t.context.createGain():t.context.createGainNode(),this._output=void 0!=t.context.createGain?t.context.createGain():t.context.createGainNode(),e.active===!1&&(this.active=!1)}return e.prototype.connect=function(t){return this._output.connect(t),this},e.prototype.disconnect=function(){return this._output.disconnect(),this},e.prototype.setActive=function(){return this},Object.defineProperty(e.prototype,"input",{get:function(){return this._input},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._output},enumerable:!0,configurable:!0}),e}();e.Effect=d;var g=function(e){function i(i){e.call(this,i),this._wet=t.safari?t.context.createGainNode():t.context.createGain(),this._wet.gain.value=i.wet,this._input.connect(this._wet),this._input.connect(this._output),this.destinationName=i.destination_name,y.instance.pushToPreLoadInitStack(this)}return __extends(i,e),i.prototype.init=function(){var t=y.instance.findInstance(this.destinationName);t&&this._wet.connect(t.input)},i.prototype.setActive=function(t){return this._input.disconnect(),t?(this._input.connect(this._wet),this._input.connect(this._output)):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"wet",{get:function(){return this._wet.gain},enumerable:!0,configurable:!0}),i}(d);e.EffectSend=g;var m=function(e){function i(i){if(e.call(this,i),this._filters=[],"Firefox"==t.browser)return this._input.connect(this._output),void 0;if(0==i.bands.length)this._input.connect(this.output);else{for(var n=0,s=i.bands.length;s>n;n++){var r=i.bands[n],o=t.context.createBiquadFilter();r.filter_type&&(o.type=v.safeFilterType(r.filter_type)),r.frequency&&(o.frequency.value=r.frequency),r.gain&&(o.gain.value=r.gain),r.Q&&(o.Q.value=r.Q),0==n?this._input.connect(o):this._filters[n-1].connect(o),this._filters.push(o)}this._filters[this._filters.length-1].connect(this._output)}}return __extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?0==this._filters.length?this._input.connect(this._output):this._input.connect(this._filters[0]):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"filters",{get:function(){return this._filters},enumerable:!0,configurable:!0}),i}(d);e.Equalizer=m;var b=function(e){function i(i){e.call(this,i),this._filter=t.context.createBiquadFilter(),this._filter.type=v.safeFilterType(i.filter_type),this._input.connect(this._filter),this._filter.connect(this._output),this._filter.frequency.value=void 0!=i.frequency?i.frequency:1e3,this._filter.Q.value=void 0!=i.Q?i.Q:1,this._filter.gain.value=void 0!=i.gain?i.gain:0}return __extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._filter):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"frequency",{get:function(){return this._filter.frequency},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"Q",{get:function(){return this._filter.Q},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gain",{get:function(){return this._filter.gain},enumerable:!0,configurable:!0}),i}(d);e.BiquadFilter=b;var S=function(e){function i(i){e.call(this,i),this._pro=t.context.createScriptProcessor(i.buffer_size||4096,2,2);var n=this;this._pro.onaudioprocess=function(t){for(var e=t.inputBuffer,i=t.outputBuffer,s=e.getChannelData(0),r=e.getChannelData(1),o=i.getChannelData(0),a=i.getChannelData(1),c=Math.pow(.5,n._bits),h=e.length,u=0,p=0,l=0,_=0;h>_;++_)(u+=n._reduction)>=1&&(u--,p=c*Math.floor(s[_]/c),l=c*Math.floor(r[_]/c)),o[_]=p,a[_]=l},this._bits=i.bits||4,this._reduction=i.reduction||.2,this._input.connect(this._pro),this._pro.connect(this._output)}return __extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?(this._input.connect(this._pro),this._input.connect(this._output)):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"bits",{get:function(){return this._bits},set:function(t){this._bits=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reduction",{get:function(){return this._reduction},set:function(t){this._reduction=t},enumerable:!0,configurable:!0}),i}(d);e.Bitcrusher=S;var T=function(e){function i(i){return e.call(this,i),this._bypass=i.bypass,t.isMobile?(this._input.connect(this._output),void 0):(this._dynamicsCompressor=t.context.createDynamicsCompressor(),this._makeUpGain=t.safari?t.context.createGainNode():t.context.createGain(),this._input.connect(this._dynamicsCompressor),this._dynamicsCompressor.connect(this._makeUpGain),this._makeUpGain.connect(this._output),this._bypass&&(this._input.connect(this._output),this._makeUpGain.gain.value=0),this._dynamicsCompressor.threshold.value=i.threshold||this._dynamicsCompressor.threshold.value,this._dynamicsCompressor.knee.value=i.knee||this._dynamicsCompressor.knee.value,this._dynamicsCompressor.ratio.value=i.ratio||this._dynamicsCompressor.ratio.value,this._dynamicsCompressor.attack.value=i.attack||this._dynamicsCompressor.attack.value,this._dynamicsCompressor.release.value=i.release||this._dynamicsCompressor.release.value,this._makeUpGain.gain.value=i.make_up_gain||this._makeUpGain.gain.value,void 0)}return __extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?(this._input.connect(this._dynamicsCompressor),this._bypass&&this._input.connect(this._output)):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"threshold",{get:function(){return this._dynamicsCompressor.threshold},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"knee",{get:function(){return this._dynamicsCompressor.knee},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ratio",{get:function(){return this._dynamicsCompressor.ratio},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"attack",{get:function(){return this._dynamicsCompressor.attack},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"release",{get:function(){return this._dynamicsCompressor.release},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reduction",{get:function(){return this._dynamicsCompressor.reduction},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"makeUpGain",{get:function(){return this._makeUpGain.gain},enumerable:!0,configurable:!0}),i}(d);e.Compressor=T;var O=function(e){function i(i){return e.call(this,i),t.isMobile?(this._input.connect(this._output),void 0):(this._soundName=i.sound,this._convolver=t.context.createConvolver(),this._input.connect(this._convolver),this._convolver.connect(this._output),y.instance.pushToPostLoadInitStack(this),void 0)}return __extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._convolver):this._input.connect(this._output),this},i.prototype.init=function(){var t=y.instance.findInstance(this._soundName);this._convolver.buffer=t.buffer},i}(d);e.Convolver=O;var P=function(t){function e(e){t.call(this,e),this._sync=e.sync}return __extends(e,t),e.prototype.init=function(){if(this._sync){var t=y.instance.findInstance(this._sync);this.updateSync(t.bpm),t.registerBPMSync(this)}},e.prototype.updateSync=function(){return this},Object.defineProperty(e.prototype,"sync",{get:function(){return this._sync},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"syncResolution",{get:function(){return this._syncResolution},set:function(t){this._syncResolution=t},enumerable:!0,configurable:!0}),e}(d);e.DelayBase=P;var x=function(e){function i(i){e.call(this,i),this._feedback=t.safari?t.context.createGainNode():t.context.createGain(),this._delay=t.safari?t.context.createDelayNode():t.context.createDelay(),i.filter?(this._filter=t.context.createBiquadFilter(),this._input.connect(this._filter),this._filter.connect(this._delay),this._filter.type=v.safeFilterType(i.filter.filter_type),this._filter.frequency.value=i.filter.frequency||1e3,this._filter.Q.value=i.filter.Q||4,this._filter.gain.value=i.filter.gain||1):this._input.connect(this._delay),this._delay.connect(this._feedback),this._delay.connect(this._output),this._feedback.connect(this._delay),this.sync?(y.instance.pushToPreLoadInitStack(this),this.syncResolution=i.delay_time||1):this._delay.delayTime.value=i.delay_time||.125,this._feedback.gain.value=i.feedback||.3,this._output.gain.value=i.output_vol||i.wet||1}return __extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._delay):this._input.connect(this._output),this},i.prototype.updateSync=function(t){return this._delay.delayTime.value=60/t*this.syncResolution,this},Object.defineProperty(i.prototype,"delayTime",{get:function(){return this._delay.delayTime},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"feedback",{get:function(){return this._feedback.gain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),i}(P);e.Delay=x;var A=function(e){function i(i){e.call(this,i),this._splitter=t.context.createChannelSplitter(2),this._merger=t.context.createChannelMerger(2),this._mono=t.safari?t.context.createGainNode():t.context.createGain(),this._leftDelay=t.safari?t.context.createDelayNode():t.context.createDelay(),this._rightDelay=t.safari?t.context.createDelayNode():t.context.createDelay(),this._feedback=t.safari?t.context.createGainNode():t.context.createGain(),i.filter?(this._filter=t.context.createBiquadFilter(),this._mono.connect(this._filter),this._filter.connect(this._leftDelay),this._feedback.connect(this._filter),this._filter.type=v.safeFilterType(i.filter.filter_type),this._filter.frequency.value=i.filter.frequency||1e3,this._filter.Q.value=i.filter.Q||4,this._filter.gain.value=i.filter.gain||1):(this._mono.connect(this._leftDelay),this._feedback.connect(this._leftDelay)),this._input.connect(this._splitter),this._splitter.connect(this._mono,0,0),this._splitter.connect(this._mono,1,0),this._leftDelay.connect(this._rightDelay),this._rightDelay.connect(this._feedback),this._leftDelay.connect(this._merger,0,0),this._rightDelay.connect(this._merger,0,1),this._merger.connect(this._output),this.sync?(y.instance.pushToPreLoadInitStack(this),this.syncResolution=i.delay_time||1):(this._leftDelay.delayTime.value=i.delay_time||.125,this._rightDelay.delayTime.value=this._leftDelay.delayTime.value),this._feedback.gain.value=i.feedback||.3,this._output.gain.value=i.output_vol||i.wet||1}return __extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._splitter):this._input.connect(this._output),this},i.prototype.updateSync=function(t){return this._leftDelay.delayTime.value=60/t*this.syncResolution,this._rightDelay.delayTime.value=this._leftDelay.delayTime.value,this},Object.defineProperty(i.prototype,"delay_time",{set:function(t){this._leftDelay.delayTime.value=t,this._rightDelay.delayTime.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"feedback",{get:function(){return this._feedback.gain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),i}(P);e.PingPongDelay=A;var k=function(e){function i(i){e.call(this,i),this.sync&&(i.left.sync=this.sync,i.right.sync=this.sync),this._splitter=t.context.createChannelSplitter(2),this._merger=t.context.createChannelMerger(2),this._leftDelay=new x(i.left||{}),this._rightDelay=new x(i.right||{}),this._input.connect(this._splitter),this._splitter.connect(this._leftDelay.input,0,0),this._splitter.connect(this._rightDelay.input,0,0),this._splitter.connect(this._rightDelay.input,1,0),this._leftDelay.output.connect(this._merger,0,0),this._rightDelay.output.connect(this._merger,0,1),this._merger.connect(this._output)
}return __extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._splitter):this._input.connect(this._output),this},i.prototype.updateSync=function(t){return this._leftDelay.updateSync(t),this._rightDelay.updateSync(t),this},Object.defineProperty(i.prototype,"leftDelay",{get:function(){return this._leftDelay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rightDelay",{get:function(){return this._rightDelay},enumerable:!0,configurable:!0}),i}(P);e.StereoDelay=k;var V=function(e){function i(i){e.call(this,i),this._compressor=t.context.createDynamicsCompressor(),this._preGain=t.safari?t.context.createGainNode():t.context.createGain(),this._postGain=t.safari?t.context.createGainNode():t.context.createGain(),this._input.connect(this._preGain),this._preGain.connect(this._compressor),this._compressor.connect(this._postGain),this._postGain.connect(this._output),this._compressor.threshold.value=i.threshold||0,this._compressor.knee.value=0,this._compressor.ratio.value=100,this._compressor.attack.value=0,this._compressor.release.value=0,this._preGain.gain.value=void 0==i.pre_gain?1:i.pre_gain,this._postGain.gain.value=void 0==i.post_gain?1:i.post_gain}return __extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._preGain):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"threshold",{get:function(){return this._compressor.threshold},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"preGain",{get:function(){return this._preGain.gain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"postGain",{get:function(){return this._postGain.gain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reduction",{get:function(){return this._compressor.reduction},enumerable:!0,configurable:!0}),i}(d);e.Limiter=V;var C=function(e){function i(n){e.call(this,n),this._name=n.name,this._panner=t.context.createPanner(),this._input.connect(this._panner),this._panner.connect(this._output),void 0!=n.panning_model&&(this._panner.panningModel=n.panning_model),void 0!=n.distance_model&&(this._panner.distanceModel=n.distance_model),void 0!=n.ref_distance&&(this._panner.refDistance=n.ref_distance),void 0!=n.max_distance&&(this._panner.maxDistance=n.max_distance),void 0!=n.rolloff_factor&&(this._panner.rolloffFactor=n.rolloff_factor),void 0!=n.cone_inner_angle&&(this._panner.coneInnerAngle=n.cone_inner_angle),void 0!=n.cone_outer_angle&&(this._panner.coneOuterAngle=n.cone_outer_angle),void 0!=n.cone_outer_gain&&(this._panner.coneOuterGain=n.cone_outer_gain),void 0!=n.position&&this._panner.setPosition(n.position[0],n.position[1],n.position[2]),void 0!=n.velocity&&this._panner.setVelocity(n.position[0],n.position[1],n.position[2]),void 0!=n.orientation&&this._panner.setOrientation(n.position[0],n.position[1],n.position[2]),i.panners[this._name]=this}return __extends(i,e),i.panners={},i._scale=1,i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._panner):this._input.connect(this._output),this},i.prototype.setPosition=function(t,e,n){this._panner.setPosition(t*i.scale,e*i.scale,n*i.scale)},i.prototype.setOrientation=function(t,e,i){this._panner.setOrientation(t,e,i)},i.prototype.setVelocity=function(t,e,i){this._panner.setVelocity(t,e,i)},Object.defineProperty(i,"listener",{get:function(){return t.context.listener},enumerable:!0,configurable:!0}),i.setListenerPosition=function(e,n,s){t.context.listener.setPosition(e*i.scale,n*i.scale,s*i.scale)},i.setListenerOrientation=function(e,i,n,s,r,o){t.context.listener.setOrientation(e,i,n,s,r,o)},i.setListenerVelocity=function(e,i,n){t.context.listener.setVelocity(e,i,n)},i.setDopplerFactor=function(e){t.context.listener.dopplerFactor=e},i.setSpeedOfSound=function(e){t.context.listener.speed=e},i.setListenerData=function(t){t&&(i.scale=t.scale,i.setListenerPosition(t.position[0],t.position[1],t.position[2]),i.setListenerOrientation(t.orientation[0],t.orientation[1],t.orientation[2],t.orientation_up[0],t.orientation_up[1],t.orientation_up[2]),i.setListenerVelocity(t.velocity[0],t.velocity[1],t.velocity[2]),i.setDopplerFactor(t.doppler_factor),i.setSpeedOfSound(t.speed_of_sound))},i.get=function(t){return i.panners[t]},Object.defineProperty(i,"scale",{get:function(){return i._scale},set:function(t){i._scale=t},enumerable:!0,configurable:!0}),i}(d);e.Panner=C;var w=function(e){function i(i){e.call(this,i),this._source=i.source,this._gain=t.safari?t.context.createGainNode():t.context.createGain(),this._processor=t.safari?t.context.createJavaScriptNode(i.buffer_size||0):t.context.createScriptProcessor(i.buffer_size||0);var n=this;this._processor.onaudioprocess=function(){var t=n._source.reduction.value;n._gain.gain.value=0==t?1:Math.pow(10,t/20)},this._input.connect(this._gain),this._input.connect(this._processor),this._processor.connect(t.context.destination),this._gain.connect(this._output),y.instance.pushToPreLoadInitStack(this)}return __extends(i,e),i.prototype.init=function(){var t=y.instance.findInstance(this._source.bus);this._source=t._effects[this._source.index]},i.prototype.setActive=function(t){return this._input.disconnect(),t?(this._input.connect(this._gain),this._input.connect(this._processor)):this._input.connect(this._output),this},i}(d);e.Sidechain=w;var G=function(e){function i(i){e.call(this,i),this._splitter=t.context.createChannelSplitter(2),this._merger=t.context.createChannelMerger(2),this._left=t.safari?t.context.createGainNode():t.context.createGain(),this._right=t.safari?t.context.createGainNode():t.context.createGain(),this._input.connect(this._splitter),this._splitter.connect(this._left,0,0),this._splitter.connect(this._right,1,0),this._left.connect(this._merger,0,0),this._right.connect(this._merger,0,1),this._merger.connect(this._output),this.pan=i.pan}return __extends(i,e),i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._splitter):this._input.connect(this._output),this},i.prototype.getGainValue=function(t){return(t+1)/2},i.prototype.setPanTo=function(t,e){var i=this.getGainValue(t);return this._left.gain.setValueAtTime(1-i,e||0),this._right.gain.setValueAtTime(i,e||0),this},i.prototype.linPanTo=function(e,i,n){n=n||t.context.currentTime;var s=this.getGainValue(e);return this._left.gain.setValueAtTime(this._left.gain.value,n),this._left.gain.linearRampToValueAtTime(1-s,t.context.currentTime+i),this._right.gain.setValueAtTime(this._right.gain.value,n),this._right.gain.linearRampToValueAtTime(s,t.context.currentTime+i),this},i.prototype.expPanTo=function(e,i,n){n=n||t.context.currentTime;var s=this.getGainValue(e);return this._left.gain.setValueAtTime(0==this._left.gain.value?v.EXP_MIN_VALUE:this._left.gain.value,n),this._left.gain.exponentialRampToValueAtTime(1-s,t.context.currentTime+i),this._right.gain.setValueAtTime(0==this._right.gain.value?v.EXP_MIN_VALUE:this._right.gain.value,n),this._right.gain.exponentialRampToValueAtTime(s,t.context.currentTime+i),this},Object.defineProperty(i.prototype,"pan",{get:function(){return this._right.gain.value},set:function(t){var e=this.getGainValue(t);this._left.gain.value=1-e,this._right.gain.value=e},enumerable:!0,configurable:!0}),i}(d);e.StereoPanner=G;var F=function(e){function i(i,n){e.call(this,i),i.sync&&(this._sync=i.sync,this._rate=i.rate||.25),this._oscillator=t.context.createOscillator(),this._amplitude=t.safari?t.context.createGainNode():t.context.createGain(),this._input.connect(this._output),this._oscillator.connect(this._amplitude),this._amplitude.connect(this._output.gain),this._oscillator.frequency.value=i.frequency||10,this._oscillator.type=i.wave||0,this._amplitude.gain.value=i.amplitude||1,this._oscillator.start(n),y.instance.pushToPreLoadInitStack(this)}return __extends(i,e),i.prototype.init=function(){if(this._sync){var t=y.instance.findInstance(this._sync);this.updateSync(t.bpm),t.registerBPMSync(this)}},i.prototype.setActive=function(t){return t?this._amplitude.connect(this._output.gain):this._amplitude.disconnect(),this},i.prototype.updateSync=function(t){return this._oscillator.frequency.value=t/60/this._rate,this},Object.defineProperty(i.prototype,"frequency",{get:function(){return this._oscillator.frequency},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"amplitude",{get:function(){return this._amplitude.gain},enumerable:!0,configurable:!0}),i}(d);e.Tremolo=F;var N=function(e){function i(i){e.call(this,i),this._samples=8192,this._type=i.distortion_type||0,this._amount=i.amount||.7,this._samples=8192,this._waveshaper=t.context.createWaveShaper(),this._inputDrive=t.safari?t.context.createGainNode():t.context.createGain(),this._outputDrive=t.safari?t.context.createGainNode():t.context.createGain(),this._input.connect(this._inputDrive),this._inputDrive.connect(this._waveshaper),this._waveshaper.connect(this._outputDrive),this._outputDrive.connect(this._output),this._ws_table=new Float32Array(this._samples),this.createWSCurve(this._type,.7)}return __extends(i,e),i.prototype.createWSCurve=function(t,e){switch(t){case 0:var i,n,e=Math.min(e,.9999),s=2*e/(1-e);for(i=0;this._samples>i;i++)n=2*i/this._samples-1,this._ws_table[i]=(1+s)*n/(1+s*Math.abs(n));break;case 1:var i,n,r;for(i=0;this._samples>i;i++)n=2*i/this._samples-1,r=(.5*Math.pow(n+1.4,2)-1)*r>=0?5.8:1.2,this._ws_table[i]=this.tanh(r);break;case 2:var i,n,r,o=1-e;for(i=0;this._samples>i;i++)n=2*i/this._samples-1,r=0>n?-Math.pow(Math.abs(n),o+.04):Math.pow(n,o),this._ws_table[i]=this.tanh(2*r);break;case 3:var i,n,r,a,o=1-e>.99?.99:1-e;for(i=0;this._samples>i;i++)n=2*i/this._samples-1,a=Math.abs(n),o>a?r=a:a>o?r=o+(a-o)/(1+Math.pow((a-o)/(1-o),2)):a>1&&(r=a),this._ws_table[i]=this.sign(n)*r*(1/((o+1)/2));break;case 4:var i,n;for(i=0;this._samples>i;i++)n=2*i/this._samples-1,this._ws_table[i]=-.08905>n?-3/4*(1-Math.pow(1-(Math.abs(n)-.032857),12)+1/3*(Math.abs(n)-.032847))+.01:n>=-.08905&&.320018>n?-6.153*n*n+3.9375*n:.630035;break;case 5:var i,n,o=2+Math.round(14*e),c=Math.round(Math.pow(2,o-1));for(i=0;this._samples>i;i++)n=2*i/this._samples-1,this._ws_table[i]=Math.round(n*c)/c}this._waveshaper.curve=this._ws_table},i.prototype.tanh=function(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))},i.prototype.sign=function(t){return 0===t?1:Math.abs(t)/t},i.prototype.setActive=function(t){return this._input.disconnect(),t?this._input.connect(this._inputDrive):this._input.connect(this._output),this},Object.defineProperty(i.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount=t,this.createWSCurve(this._type,this._amount)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this.createWSCurve(this._type,this._amount)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"drive",{get:function(){return this._inputDrive.gain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"outputGain",{get:function(){return this._outputDrive.gain},enumerable:!0,configurable:!0}),i}(d);e.Distortion=N;var E=function(){function e(e,i){this._targets=e.targets,this._sync=e.sync,this._rate=e.rate||1,this._phaseVal=e.phase||0,this._oscillator=t.context.createOscillator(),this._oscillator.type=e.wave||0,this._oscillator.frequency.value=this._rate,this._amplitude=t.safari?t.context.createGainNode():t.context.createGain(),this._amplitude.gain.value=e.amplitude||1,this._phase=t.safari?t.context.createDelayNode():t.context.createDelay(),this._phase.delayTime.value=this._phaseVal*(1/this._oscillator.frequency.value),this._oscillator.connect(this._phase),this._phase.connect(this._amplitude),t.safari?this._oscillator.noteOn(i):this._oscillator.start(i),y.instance.pushToPreLoadInitStack(this)}return e.prototype.init=function(){if(this._sync){var t=y.instance.findInstance(this._sync);this.updateSync(t.bpm),t.registerBPMSync(this)}for(var e=0,i=this._targets.length;i>e;e++){var n=this._targets[e],s=y.instance.findInstance(n.bus),r=s.effects[n.effect];this._amplitude.connect(r[n.param])}},e.prototype.updateSync=function(t){return this._oscillator.frequency.value=t/60/this._rate,this._phase.delayTime.value=this._phaseVal*(1/this._oscillator.frequency.value),this},e}();e.LFO=E;var M=function(){function e(e,i){this._arpCounter=0,this._arpNoteLength=.5,this._name=i,this._type=e.type,this._output=t.safari?t.context.createGainNode():t.context.createGain(),this._output.gain.value=e.volume||1,e.destination_name&&(this.destinationName=e.destination_name,y.instance.initComplete||y.instance.pushToConnectStack(this)),e.arp?(this._arpMode=e.arp.arp_mode||"off",this._octaves=e.arp.octaves||1,this._sync=e.arp.sync):this._arpMode="off",this._activeVoices=[],this._arpVoices=[],this._beatSubscription=e.beat_subscription||.25,this.data=e}return e.prototype.connect=function(t){return this._output.connect(t),this},e.prototype.disconnect=function(){return this._output.disconnect(),this},e.prototype.handleMidiEvent=function(){return this},e.prototype.stop=function(){},e.prototype.handleArpModes=function(){if(this._arpVoices=[],this._octaves>1){for(var t=[],e=0;this._octaves-1>e;e++)for(var i=0;this._activeVoices.length>i;i++){var n=this._activeVoices[i].midiEvent,s=n.noteNumber,r={type:"channel",subtype:n.subtype,noteNumber:s+=12*(e+1),velocity:n.velocity,deltaTime:n.deltaTime};t.push({midiEvent:r,transpose:this._activeVoices[i].transpose})}this._arpVoices=this._activeVoices.concat(t)}else this._arpVoices=this._activeVoices;if("up"===this._arpMode)this._arpVoices=this._arpVoices.sort(this.sortVoices);else if("down"===this._arpMode)this._arpVoices=this._arpVoices.sort(this.sortVoices),this._arpVoices.reverse();else if("up-down"===this._arpMode){var o=this._arpVoices.slice(0);o.sort(this.sortVoices);var a=this._arpVoices.slice(0);a.sort(this.sortVoices),a.reverse(),this._arpVoices=o.concat(a),this._arpVoices.length>1&&(this._arpVoices.splice(this._arpVoices.length/2,1),this._arpVoices.pop())}else"random"===this._arpMode&&(this._arpVoices=v.shuffle(this._arpVoices))},e.prototype.sortVoices=function(t,e){return t.midiEvent.noteNumber<e.midiEvent.noteNumber?-1:t.midiEvent.noteNumber>e.midiEvent.noteNumber?1:0},e.prototype.arpActive=function(t){if(t){if(this._sync){var e=y.instance.findInstance(this._sync);e.registerSynth(this),e._started||e.start()}}else if(this._arpMode="off",this._sync){var e=y.instance.findInstance(this._sync);e.unregisterSynth(this)}},e.prototype.update=function(t,e){if(0==t%this._beatSubscription){if(0===this._arpVoices.length)return;if(this._arpCounter++,this._arpCounter=this._arpCounter%this._arpVoices.length,this._arpCounter<this._arpVoices.length){this.handleMidiEvent(this._arpVoices[this._arpCounter].midiEvent,e,this._arpVoices[this._arpCounter].transpose,!0);var i={type:"channel",subtype:"noteOff",noteNumber:this._arpVoices[this._arpCounter].midiEvent.noteNumber,velocity:this._arpVoices[this._arpCounter].midiEvent.velocity,deltaTime:this._arpVoices[this._arpCounter].midiEvent.deltaTime};this.handleMidiEvent(i,e+this._arpNoteLength,this._arpVoices[this._arpCounter].transpose,!0)}}},e.prototype.deschedule=function(){return this},Object.defineProperty(e.prototype,"output",{get:function(){return this._output},enumerable:!0,configurable:!0}),e}();e.Synth=M,e.generateNoiseBuffer=n;var q=function(){function e(e,i,n,s,r){this.filterStartFreq=-1,this.voiceType=i,this.active=!1,this.activatedNote=-1,this._enabled=!0,this._detune=e.detune||0,this._wave=e.wave||0,this._frames=e.frames,this._algorithm=e.algorithm,r&&(this._noiseBuffer=r),this.gain=t.safari?t.context.createGainNode():t.context.createGain(),this._filterData=n}return e.prototype.noteOn=function(e,i,n,s,r,o,a){if(this.enabled){if(4!==this._wave?(this.source=t.context.createOscillator(),this.source.type=this._wave,this.source.detune.value=this._detune):4==this._wave&&(this.source=t.context.createBufferSource(),this.source.buffer=this._noiseBuffer,this.source.loop=!0),this._envelope=t.context.createGain(),this._filterData?(this.filter=t.context.createBiquadFilter(),this.filter.type=v.safeFilterType(this._filterData.filter_type),this.filter.frequency.value=void 0==this._filterData.frequency?v.NYQUIST_FREQUENCY:this._filterData.frequency,this.filter.detune&&(this.filter.detune.value=this._filterData.detune||0),this.filter.Q.value=this._filterData.Q||this.filter.Q,this.filter.gain.value=this._filterData.gain||this.filter.gain,this.filterTargetFreq=this.filter.frequency.value,this.source.connect(this.filter),this.filter.connect(this._envelope),this._envelope.connect(this.gain)):(this.source.connect(this._envelope),this._envelope.connect(this.gain)),1==this.voiceType&&this.filterAmplitudeGainNode.connect(this.filter.frequency),v.now()>n&&(n=v.now()),this.active=!0,this.activatedNote=e,4!==this._wave){var c=v.midiNoteToFrequency(e+a);if(o){var h=-1;o.contour>0?h=c*(1-o.contour):0>o.contour&&(h=(v.NYQUIST_FREQUENCY-c)*-o.contour+c),this.source.frequency.cancelScheduledValues(n),-1!=h?(this.source.frequency.setValueAtTime(h,n),t.safari?this.source.frequency.setTargetValueAtTime(c,n,o.decay):this.source.frequency.setTargetAtTime(c,n,o.decay)):this.source.frequency.setValueAtTime(c,n)}else this.source.frequency.setValueAtTime(c,n)}r&&(this.filterStartFreq=-1,0>r.contour?this.filterStartFreq=this.filterTargetFreq*(1+r.contour)+1:r.contour>0&&(this.filterStartFreq=(v.NYQUIST_FREQUENCY-this.filterTargetFreq)*r.contour+this.filterTargetFreq),-1!=this.filterStartFreq&&(this.filter.frequency.cancelScheduledValues(n),this.filter.frequency.setValueAtTime(this.filterStartFreq,n),this.filter.frequency.exponentialRampToValueAtTime(this.filterTargetFreq,n+r.attack),t.safari?this.filter.frequency.setTargetValueAtTime(this.filterTargetFreq*r.sustain,n+r.attack,r.decay):this.filter.frequency.setTargetAtTime(this.filterTargetFreq*r.sustain,n+r.attack,r.decay)));var u;u="linear"===s.volumeCurve?i/128:"exponential"===s.volumeCurve?Math.abs(1-Math.exp(i/128)):1,s?(this._envelope.gain.setValueAtTime(0,n),this._envelope.gain.linearRampToValueAtTime(u,n+s.attack),t.safari?this._envelope.gain.setTargetValueAtTime(u*s.sustain,n+s.attack,s.decay):this._envelope.gain.setTargetAtTime(u*s.sustain,n+s.attack,s.decay)):this._envelope.gain.setValueAtTime(u,n),this.source.startTime=n,t.safari?this.source.noteOn(n):this.source.start(n)}},e.prototype.noteOff=function(e,i,n,s){if(this.enabled){if(v.now()>i&&(i=v.now()),this.active=!1,s&&-1!=this.filterStartFreq){var r=this.filter.frequency.value;this.filter.frequency.cancelScheduledValues(i),this.filter.frequency.setValueAtTime(r,i),t.safari?this.filter.frequency.setTargetValueAtTime(this.filterStartFreq,i,s.release):this.filter.frequency.setTargetAtTime(this.filterStartFreq,i,s.release)}n?(this._envelope.gain.cancelScheduledValues(i),i!=v.now()?this._envelope.gain.setValueAtTime(n.sustain,i):this._envelope.gain.setValueAtTime(this._envelope.gain.value,i),t.safari?this._envelope.gain.setTargetValueAtTime(0,i,n.release):this._envelope.gain.setTargetAtTime(0,i,n.release)):this._envelope.gain.setValueAtTime(0,i),this.source.offTime=i,t.safari?this.source.noteOff(i+5*n.release):this.source.stop(i+5*n.release)}},e.prototype.stop=function(){this.filter.frequency.cancelScheduledValues(0),this._envelope.gain.cancelScheduledValues(0),this._envelope.gain.setValueAtTime(0,0),t.safari?this.source.noteOff(0):this.source.stop(0),this.source.disconnect(),this.filter&&this.filter.disconnect(),this._envelope&&this._envelope.disconnect()},e.prototype.stopSoft=function(e,i){this.active=!1,this._envelope.gain.cancelScheduledValues(e),t.safari?this._envelope.gain.setTargetValueAtTime(0,e,i.release):this._envelope.gain.setTargetAtTime(0,e,i.release);var n=e+5*i.release;t.safari?this.source.noteOff(n):this.source.stop(n);var s=this;setTimeout(function(){s.source.disconnect(),s.filter&&s.filter.disconnect(),s._envelope&&s._envelope.disconnect()},1e3*(n-v.now()))},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!0,configurable:!0}),e}(),I=function(){function e(e,i,s){this._enabled=!0,this.nextVoice=0,this.octave=e.octave||0,this.output=t.safari?t.context.createGainNode():t.context.createGain(),this.output.gain.value=void 0==e.volume?1:e.volume,this._data=e,this._poly=i,this._filterData=s,this.voices=[],4==e.wave&&(this._noiseBuffer=n(this._data._frames,this._data._algorithm))}return e.prototype.noteOn=function(t,e,i,n,s,r,o){if(this.enabled){this.voices.length==this._poly&&(this.voices[0].noteOff(t,i,n,s),this.voices.splice(0,1)),t+=12*this.octave;var a;a=4==this._data.wave?new q(this._data,0,this._filterData,i,this._noiseBuffer):new q(this._data,0,this._filterData,i,null),a.gain.connect(this.output),a.noteOn(t,e,i,n,s,r,o),this.lfoPitchGainNode&&4!=this._data.wave&&this.lfoPitchGainNode.connect(a.source.frequency),this.filterAmplitude&&a.filter&&this.filterAmplitude.connect(a.filter.frequency),this.voices.push(a)}},e.prototype.noteOff=function(t,e,i,n){if(this.enabled){t+=12*this.octave;for(var s=0;this.voices.length>s;s++)if(this.voices[s].active&&this.voices[s].activatedNote==t){this.voices[s].noteOff(t,e,i,n),this.voices.splice(s,1);break}}},e.prototype.stopSoft=function(t,e,i){for(var n=0;this.voices.length>n;n++)this.voices[n].stopSoft(t,e,i);this.voices=[]},e.prototype.stop=function(){for(var t=0,e=this.voices.length;e>t;t++)this.voices[t].stop();this.voices=[]},e.prototype.deschedule=function(){for(var e=0,i=this.voices.length;i>e;e++)if(this.voices[e]){var n=this.voices[e].source;(1==n.playbackState||n.startTime>t.context.currentTime)&&(this.voices[e].stop(),this.voices.splice(e,1),e--)}},e.prototype.setDetune=function(t,e){if(this._data){this._data.detune=t;for(var i=0,n=this.voices.length;n>i;i++)this.voices[i].source.detune.setValueAtTime(t,e)}},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"detune",{get:function(){return this._detune},enumerable:!0,configurable:!0}),e}(),j=function(){function e(e,i){this.osc=t.context.createOscillator(),this.phaseDelay=t.safari?t.context.createDelayNode():t.context.createDelay(),this.osc.type=e.wave||0,this.osc.frequency.value=e.rate||1,this.phase=e.phase||0,this.phaseDelay.delayTime.value=this.phase*(1/this.osc.frequency.value),this.sync=e.sync,this.syncResolution=e.rate,this.osc.connect(this.phaseDelay),this.oscVolumeAmplitude=t.safari?t.context.createGainNode():t.context.createGain(),this.oscVolumeAmplitude.gain.value=e.osc_volume_amount,this.phaseDelay.connect(this.oscVolumeAmplitude),this.pitchAmplitude=t.safari?t.context.createGainNode():t.context.createGain(),this.pitchAmplitude.gain.value=e.pitch_amount,this.phaseDelay.connect(this.pitchAmplitude),this.filterAmplitude=t.safari?t.context.createGainNode():t.context.createGain(),this.filterAmplitude.gain.value=e.filter_amount,this.phaseDelay.connect(this.filterAmplitude),t.safari?this.osc.noteOn(i):this.osc.start(i)}return e.prototype.updateSync=function(t){return this.osc.frequency.value=t/60/this.syncResolution,this.phaseDelay.delayTime.value=this.phase*(1/this.osc.frequency.value),this},e}(),L=function(e){function i(i,n){e.call(this,i,n),this.bendRange=400;var s=t.context.currentTime+v.OSC_START_DELAY;this._gainEG=i.gain_eg,this._filterEG=i.filter_eg,this._pitchEG=i.pitch_eg,this._oscs=[],this._poly=i.poly;for(var r=0,o=i.oscillators.length;o>r;r++){var a=new I(i.oscillators[r],i.poly,i.filter,s);a.output.connect(this.output),this._oscs.push(a)}if(i.LFO){this._LFO=new j(i.LFO,s);for(var r=0,o=this._oscs.length;o>r;r++){var c=this._oscs[r];this._LFO.oscVolumeAmplitude&&this._LFO.oscVolumeAmplitude.connect(c.output.gain),this._LFO.pitchAmplitude&&(c.lfoPitchGainNode=this._LFO.pitchAmplitude),this._LFO.filterAmplitude&&(c.filterAmplitude=this._LFO.filterAmplitude)}this._LFO.sync&&y.instance.pushToPreLoadInitStack(this)}this._sync&&y.instance.pushToPreLoadInitStack(this)}return __extends(i,e),i.prototype.init=function(){if(this._LFO&&this._LFO.sync){var t=y.instance.findInstance(this._LFO.sync);this._LFO.updateSync(t.bpm),t.registerBPMSync(this._LFO)}if(this._sync){var t=y.instance.findInstance(this._sync);t.registerSynth(this),t.started||t.start()}},i.prototype.handleMidiEvent=function(e,i,n,s){if(i=i||t.context.currentTime,s=s||!1,n=n||0,"channel"==e.type)if("noteOn"==e.subtype){if("off"!=this._arpMode&&!s)return this._activeVoices.push({midiEvent:e,transpose:n}),this.handleArpModes(e),void 0;for(var r=0,o=this._oscs.length;o>r;r++)this._oscs[r].noteOn(e.noteNumber,e.velocity,i,this._gainEG,this._filterEG,this._pitchEG,n)}else if("noteOff"==e.subtype){if("off"!=this._arpMode&&!s){for(var a=0;this._activeVoices.length>a;a++)e.noteNumber===this._activeVoices[a].midiEvent.noteNumber&&this._activeVoices.splice(a,1);return this.handleArpModes(e),void 0}for(var r=0,o=this._oscs.length;o>r;r++)this._oscs[r].noteOff(e.noteNumber,i,this._gainEG,this._filterEG)}else if("pitchBend"==e.subtype){var c;void 0!=e.value?c=e.value:void 0!=e.velocity&&(c=e.velocity);for(var h=(c-8192)/16384*this.bendRange,a=0;this._oscs.length>a;a++)this._oscs[a].setDetune(h,i)}return this},i.prototype.glideTo=function(t,e,i,n){var s=v.now();e=e||s,void 0==i&&(i=.5),n=n||0;for(var r=0,o=this._oscs.length;o>r;r++)for(var a=this._oscs[r],c=Math.min(t.length,a.voices.length),h=0;c>h;h++){var u=a.voices[h],p=v.midiNoteToFrequency(t[h]+n+12*a.octave);u.source.frequency&&(u.source.frequency.cancelScheduledValues(s),u.source.frequency.setValueAtTime(u.source.frequency.value,e),u.source.frequency.linearRampToValueAtTime(p,e+i))}return this},i.prototype.stop=function(t){t=t||v.now();for(var e=0,i=this._oscs.length;i>e;e++)this._oscs[e].stopSoft(t,this._gainEG,this._filterEG);this._activeVoices.length&&(this._activeVoices=[])},i.prototype.deschedule=function(){for(var t=0,e=this._oscs.length;e>t;t++)this._oscs[t].deschedule();return this},Object.defineProperty(i.prototype,"filterFrequency",{set:function(t){for(var e=0,i=this._oscs.length;i>e;e++){var n=this._oscs[e];n._filterData.frequency=t;for(var s=0,r=n.voices.length;r>s;s++){var o=n.voices[s];o.filterTargetFreq=t,this._filterEG&&0!=this._filterEG.contour||(o.filter.frequency.value=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filterQ",{set:function(t){for(var e=0,i=this._oscs.length;i>e;e++){var n=this._oscs[e];n._filterData.Q=t;for(var s=0,r=n.voices.length;r>s;s++){var o=n.voices[s];o.filterTargetFreq=t,this._filterEG&&0!=this._filterEG.contour||(o.filter.Q.value=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filterType",{set:function(t){for(var e=0,i=this._oscs.length;i>e;e++){var n=this._oscs[e];n._filterData.filter_type=t;for(var s=0,r=n.voices.length;r>s;s++){var o=n.voices[s];o.filter.type=t}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Wave",{set:function(t){var e=this._oscs[0];e._data.wave=t;for(var i=0,n=e.voices.length;n>i;i++){var s=e.voices[i];s.source.type&&"4"!==t&&(s.source.type=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Vol",{set:function(t){var e=this._oscs[0];e.output.gain.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Detune",{set:function(t){var e=this._oscs[0];e._detune=t;for(var i=0,n=e.voices.length;n>i;i++){var s=e.voices[i];s.source.detune&&(s.source.detune.value=t)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc1Octave",{set:function(t){var e=this._oscs[0];e.octave=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc2Wave",{set:function(t){if(!(2>this._oscs.length)){var e=this._oscs[1];e._data.wave=t;for(var i=0,n=e.voices.length;n>i;i++){var s=e.voices[i];s.source.type&&"4"!==t&&(s.source.type=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc2Vol",{set:function(t){if(!(2>this._oscs.length)){var e=this._oscs[1];e.output.gain.value=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc2Detune",{set:function(t){if(!(2>this._oscs.length)){var e=this._oscs[1];e._detune=t;for(var i=0,n=e.voices.length;n>i;i++){var s=e.voices[i];s.source.detune&&(s.source.detune.value=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"osc2Octave",{set:function(t){if(!(2>this._oscs.length)){var e=this._oscs[1];e.octave=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pitchDecay",{set:function(t){this._pitchEG&&(this._pitchEG.decay=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pitchContour",{set:function(t){this._pitchEG&&(this._pitchEG.contour=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoWave",{set:function(t){this._LFO&&(this._LFO.osc.type=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoRate",{set:function(t){this._LFO&&(this._LFO.osc.frequency.value=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoPhase",{set:function(t){this._LFO&&(this._LFO.phase=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoOscVol",{set:function(t){this._LFO&&(this._LFO.oscVolumeAmplitude.gain.value=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoPitch",{set:function(t){this._LFO&&(this._LFO.pitchAmplitude.gain.value=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lfoFilter",{set:function(t){this._LFO&&(this._LFO.filterAmplitude.gain.value=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"arpMode",{set:function(t){this._arpMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"arpOctaves",{set:function(t){this._octaves=t},enumerable:!0,configurable:!0}),i}(M);e.Symple=L;var D=function(e){function i(t,i){e.call(this,t,i),this._content=[],this._playingVoices=[],this._allVoices=[],this._hasNoteOffSamples=!1,this._hasSustainOnSamples=!1,this._hasSustainOffSamples=!1,this._pitchBendRange=.25,this._pedalOnTime=-1,this._sustained=[],this._maxNotes=20,this._stopFactor=5,this._content=t.content,this._volumeCurve=t.volume_curve||"none",this._gainEG=t.eg_gain||{attack:0,decay:0,sustain:1,release:.005},this._currentPitch=1,y.instance.pushToPreLoadInitStack(this)}return __extends(i,e),i.prototype.init=function(){this._envelope=t.safari?t.context.createGainNode():t.context.createGain();for(var e=0,i=this._content.length;i>e;e++){"noteOff"===this._content[e].value&&(this._hasNoteOffSamples=!0),"sustainOn"===this._content[e].value&&(this._hasSustainOnSamples=!0),"sustainOff"===this._content[e].value&&(this._hasSustainOffSamples=!0);for(var n=0;this._content[e].samples.length>n;n++)this._content[e].samples[n].source=y.instance.findInstance(this._content[e].samples[n].source),this._content[e].samples[n].source._parentType="SamplePlayer",this._content[e].samples[n].source.loop&&(this._loopedSamples=!0)}if(this._sync){var s=y.instance.findInstance(this._sync);s.registerSynth(this),s.started||s.start()}},i.prototype.handleMidiEvent=function(t,e,i,n){if(e=e||v.now(),n=n||!1,i=i||0,"channel"==t.type)if("noteOn"==t.subtype){if("off"!=this._arpMode&&!n)return this._activeVoices.push({midiEvent:t,transpose:i}),this.handleArpModes(t),void 0;this.noteOn(e,t.noteNumber,i,t.velocity,t.subtype),this._callback&&this._callback(t,e)}else if("noteOff"==t.subtype){if("off"!=this._arpMode&&!n){for(var s=0;this._activeVoices.length>s;s++)t.noteNumber===this._activeVoices[s].midiEvent.noteNumber&&this._activeVoices.splice(s,1);return this.handleArpModes(t),void 0}this.noteOff(e,t.noteNumber,t.velocity,t.subtype),this._callback&&this._callback(t,e)}else if("pitchBend"==t.subtype){var r=t.value;this._currentPitch=1+(r-64)/127;for(var s=0;this._playingVoices.length>s;s++)this._playingVoices[s].source.playbackRateNode.setValueAtTime(this._currentPitch,e)
}else if("controller"==t.subtype){var o=t.controllerType||t.noteNumber,a=void 0==t.value?t.velocity:t.value;switch(o){case 1:break;case 64:64>a?(this.pedalRelease(e),e>this._pedalOnTime&&(this._pedalOnTime=-1),this._hasSustainOffSamples&&this.noteOn(e,0,0,127,"sustainOff")):a>64&&(this._pedalOnTime=e,this._hasSustainOnSamples&&this.noteOn(e,0,0,127,"sustainOn"));break;default:}}return this},i.prototype.noteOn=function(e,i,n,s,r,a){for(var c=0;this._allVoices.length>c;c++){var h=this._allVoices[c];(0==h.source._sources.length||3==h.source.lastSource.playbackState)&&(this._allVoices.splice(c,1),c--)}var u=this.getNote(i+n,s,r),p=v.midiNoteToFrequency(i+n),l=v.midiNoteToFrequency(u.root),_=p/l;-1===u.root&&(_=1);var f=new o(u.source.data,""+i);if("noteOn"===r){var d={source:f,time:e,velocity:s,note:i,transpose:n};this._playingVoices.push(d),this._allVoices.push(d)}this.destinationName?f.connect(y.instance.findInstance(this.destinationName).input):f.connect(y.instance.findInstance(f.destinationName).input);var g=0;a?g=a*s/128:"linear"===this._volumeCurve?g=s/128:"exponential"===this._volumeCurve?g=Math.abs(1-Math.exp(s/128)):"none"===this._volumeCurve&&(g=1),g*=f.output.gain.value,f.output.gain.cancelScheduledValues(e),f.nextPlaybackRate=_*this._currentPitch,f.play(v.now()>=e?0:e),0===this._gainEG.attack?f.output.gain.setValueAtTime(g,e):(f.output.gain.value=0,f.output.gain.setValueAtTime(0,e),f.output.gain.linearRampToValueAtTime(g,e+this._gainEG.attack),t.safari?f.output.gain.setTargetValueAtTime(g*this._gainEG.sustain,e+this._gainEG.attack,this._gainEG.decay):f.output.gain.setTargetAtTime(g*this._gainEG.sustain,e+this._gainEG.attack,this._gainEG.decay))},i.prototype.noteOff=function(e,i,n,s){this.getNote(i,n,"noteOn");for(var r=0;this._playingVoices.length>r;r++)if(!i||""+i===this._playingVoices[r].source._name)if(e>this._pedalOnTime&&this._pedalOnTime>0)this._sustained.length>this._maxNotes&&(this._sustained[0].source.stop(e+this._gainEG.release*this._stopFactor),this._sustained.splice(0,1)),this._sustained.push(this._playingVoices[r]),this._playingVoices.splice(r,1);else{v.now()>e&&(e=v.now());var o=this._playingVoices[r].source.output.gain.value;if(this._playingVoices[r].source.output.gain.cancelScheduledValues(e),this._playingVoices[r].source.output.gain.setValueAtTime(o,e),this._playingVoices[r].source.stop(e+this._gainEG.release*this._stopFactor),t.safari?this._playingVoices[r].source.output.gain.setTargetValueAtTime(0,e,this._gainEG.release):this._playingVoices[r].source.output.gain.setTargetAtTime(0,e,this._gainEG.release),this._hasNoteOffSamples){var a=v.now()-this._playingVoices[r].time,c=Math.min(Math.exp(-a)/3,1);this.noteOn(e,i,this._playingVoices[r].transpose,this._playingVoices[r].velocity,s,c)}this._playingVoices.splice(r,1)}},i.prototype.stop=function(e){var e=e||v.now();this.pedalRelease(e);for(var i=0;this._playingVoices.length>i;i++){v.now()>e&&(e=v.now());var n=this._playingVoices[i].source.output.gain.value;this._playingVoices[i].source.output.gain.cancelScheduledValues(e),this._playingVoices[i].source.output.gain.setValueAtTime(n,e),this._playingVoices[i].source.stop(e+this._gainEG.release*this._stopFactor),t.safari?this._playingVoices[i].source.output.gain.setTargetValueAtTime(0,e,this._gainEG.release):this._playingVoices[i].source.output.gain.setTargetAtTime(0,e,this._gainEG.release)}return this._playingVoices=[],this},i.prototype.deschedule=function(){for(var t=0;this._allVoices.length>t;t++)this._allVoices[t].source.deschedule();return this},i.prototype.pedalRelease=function(e){for(var i=0;this._sustained.length>i;i++)if(v.now()>e&&(e=v.now()),"Firefox"!=t.browser){if(t.safari?this._sustained[i].source.output.gain.setTargetValueAtTime(0,e,this._gainEG.release):this._sustained[i].source.output.gain.setTargetAtTime(0,e,this._gainEG.release),this._hasNoteOffSamples){var n=v.now()-this._sustained[i].time,s=Math.min(Math.exp(-n)/3,1);this.noteOn(e,this._sustained[i].note,this._sustained[i].transpose,this._sustained[i].velocity,"noteOff",s)}}else this._sustained[i].source.output.gain.linearRampToValueAtTime(0,e+.3),this._sustained[i].source.stop(e+this._gainEG.release*this._stopFactor);this._sustained=[]},i.prototype.getNote=function(t,e,i){var n=0;for(this._content[n].value||"noteOn";e>this._content[n].highVelocity||i!==this._content[n].value;)n++;for(var s=n,r=0;this._content[s].samples[r].startRange>t||t>this._content[s].samples[r].endRange;)r++;return this._content[s].samples[r]},Object.defineProperty(i.prototype,"content",{get:function(){return this._content},set:function(t){this._content=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"callbackFunction",{set:function(t){this._callback=t},enumerable:!0,configurable:!0}),i}(M);e.SamplePlayer=D;var R=function(){function e(e,i,n){this._type="SmattrKick1",this._volume=void 0!=e.volume?e.volume:1,this._pitchTargetFreq=void 0!=e.pitch_target_freq?e.pitch_target_freq:62,this._pitchStartFreq=void 0!=e.pitch_start_freq?e.pitch_start_freq:200,this._pitchDecay=void 0!=e.pitch_decay?e.pitch_decay:.04,this._gainDecay=void 0!=e.gain_decay?e.gain_decay:.07,this._sine=t.context.createOscillator(),this._filter=t.context.createBiquadFilter(),this._gain=t.safari?t.context.createGainNode():t.context.createGain(),this._filter.type=t.safari?0:"lowpass",this._filter.frequency.value=void 0!=e.lowpass_frequency?e.lowpass_freq:500,this._filter.Q.value=void 0!=e.lowpass_Q?e.lowpass_Q:3,this._sine.connect(this._filter),this._filter.connect(this._gain),this._gain.connect(n),this._gain.gain.value=0,t.safari?this._sine.noteOn(i):this._sine.start(i)}return e.prototype.play=function(e,i){i=i||t.context.currentTime,this._sine.frequency.setValueAtTime(this._pitchStartFreq,i),t.safari?this._sine.frequency.setTargetValueAtTime(this._pitchTargetFreq,i,this._pitchDecay):this._sine.frequency.setTargetAtTime(this._pitchTargetFreq,i,this._pitchDecay),this._gain.gain.setValueAtTime(this._volume,i),t.safari?this._gain.gain.setTargetValueAtTime(0,i,this._gainDecay):this._gain.gain.setTargetAtTime(0,i,this._gainDecay)},e}(),U=function(){function e(e,i,n){this._type="SmattrKick2",this._subVolume=void 0!=e.sub_volume?e.sub_volume:1,this._subDecay=void 0!=e.sub_decay?e.sub_decay:.04,this._fmAmount=void 0!=e.fm_amount?e.fm_amount:30,this._fmDecay=void 0!=e.fm_decay?e.fm_decay:.08,this._fmSustain=void 0!=e.fm_sustain?e.fm_sustain:.4,this._subSine=t.context.createOscillator(),this._subGain=t.safari?t.context.createGainNode():t.context.createGain(),this._fmSine=t.context.createOscillator(),this._fmGain=t.safari?t.context.createGainNode():t.context.createGain(),this._filter=t.context.createBiquadFilter(),this._gain=t.safari?t.context.createGainNode():t.context.createGain(),this._subSine.frequency.value=void 0!=e.sub_frequency?e.sub_freq:62,this._subGain.gain.value=0,this._fmSine.frequency.value=void 0!=e.fm_frequency?e.fm_freq:62,this._fmGain.gain.value=this._fmAmount*this._fmSustain,this._gain.gain.value=void 0!=e.volume?e.volume:1,this._filter.type=t.safari?0:"lowpass",this._filter.frequency.value=void 0!=e.lowpass_frequency?e.lowpass_freq:1500,this._filter.Q.value=void 0!=e.lowpass_Q?e.lowpass_q:1,this._fmSine.connect(this._fmGain),this._fmGain.connect(this._subSine.frequency),this._subSine.connect(this._subGain),this._subGain.connect(this._filter),this._filter.connect(this._gain),this._gain.connect(n),t.safari?this._subSine.noteOn(i):this._subSine.start(i),t.safari?this._fmSine.noteOn(i):this._fmSine.start(i)}return e.prototype.play=function(e,i){this._subGain.gain.setValueAtTime(this._subVolume,i),t.safari?this._subGain.gain.setTargetValueAtTime(0,i,this._subDecay):this._subGain.gain.setTargetAtTime(0,i,this._subDecay),this._fmGain.gain.setValueAtTime(this._fmAmount,i),t.safari?this._fmGain.gain.setTargetValueAtTime(this._fmAmount*this._fmSustain,i,this._fmDecay):this._fmGain.gain.setTargetAtTime(this._fmAmount*this._fmSustain,i,this._fmDecay)},e}(),B=function(){function e(e,i,s){this._type="SmattrSnare",this._noiseVolume=void 0!=e.noise_volume?e.noise_volume:.6,this._noiseHold=void 0!=e.noise_hold?e.noise_hold:.05,this._noiseDecay=void 0!=e.noise_decay?e.noise_decay:.06,this._sineVolume=void 0!=e.sine_volume?e.sine_volume:.5,this._sineDecay=void 0!=e.sine_decay?e.sine_decay:.05,this._noise=t.context.createBufferSource(),this._noise.buffer=n(void 0,1),this._noise.loop=!0,this._noiseGain=t.safari?t.context.createGainNode():t.context.createGain(),this._sine=t.context.createOscillator(),this._sineGain=t.safari?t.context.createGainNode():t.context.createGain(),this._hpf=t.context.createBiquadFilter(),this._lpf=t.context.createBiquadFilter(),this._outGain=t.safari?t.context.createGainNode():t.context.createGain(),this._sine.frequency.value=void 0!=e.sine_frequency?e.sine_freq:123,this._outGain.gain.value=void 0!=e.volume?e.volume:1,this._hpf.type=t.safari?0:"highpass",this._hpf.frequency.value=void 0!=e.highpass_freq?e.highpass_freq:20,this._hpf.Q.value=void 0!=e.highpass_Q?e.highpass_q:.05,this._lpf.type=t.safari?0:"lowpass",this._lpf.frequency.value=void 0!=e.lowpass_freq?e.lowpass_freq:6500,this._lpf.Q.value=void 0!=e.lowpass_Q?e.lowpass_q:.01,this._noise.connect(this._noiseGain),this._sine.connect(this._sineGain),this._noiseGain.connect(this._hpf),this._sineGain.connect(this._hpf),this._hpf.connect(this._lpf),this._lpf.connect(this._outGain),this._outGain.connect(s),this._noiseGain.gain.value=0,this._sineGain.gain.value=0,t.safari?this._noise.noteOn(i):this._noise.start(i),t.safari?this._sine.noteOn(i):this._sine.start(i)}return e.prototype.play=function(e,i){this._noiseGain.gain.setValueAtTime(this._noiseVolume,i),t.safari?this._noiseGain.gain.setTargetValueAtTime(0,i+this._noiseHold,this._noiseDecay):this._noiseGain.gain.setTargetAtTime(0,i+this._noiseHold,this._noiseDecay),this._sineGain.gain.setValueAtTime(this._sineVolume,i),t.safari?this._sineGain.gain.setTargetValueAtTime(0,i,this._sineDecay):this._sineGain.gain.setTargetAtTime(0,i,this._sineDecay)},e}(),H=function(){function e(e,i,s){this._type="SmattrHihat",this._noiseVolume=void 0!=e.noise_volume?e.volume:.6,this._noiseAttack=void 0!=e.noise_attack?e.noise_attack:5e-4,this._noiseHold=void 0!=e.noise_hold?e.noise_hold:.005,this._noiseDecay=void 0!=e.noise_decay?e.noise_decay:.03,this._noise=t.context.createBufferSource(),this._noise.buffer=n(void 0,1),this._noise.loop=!0,this._noiseGain=t.safari?t.context.createGainNode():t.context.createGain(),this._hpf=t.context.createBiquadFilter(),this._hpf.type=t.safari?0:"highpass",this._hpf.frequency.value=void 0!=e.highpass_freq?e.highpass_freq:6500,this._hpf.Q.value=void 0!=e.highpass_Q?e.highpass_q:.05,this._noise.connect(this._noiseGain),this._noiseGain.connect(this._hpf),this._hpf.connect(s),this._noiseGain.gain.value=0,t.safari?this._noise.noteOn(i):this._noise.start(i)}return e.prototype.play=function(e,i){this._noiseGain.gain.cancelScheduledValues(i),this._noiseGain.gain.setValueAtTime(0,i),this._noiseGain.gain.linearRampToValueAtTime(this._noiseVolume,i+this._noiseAttack),t.safari?this._noiseGain.gain.setTargetValueAtTime(0,i+this._noiseAttack+this._noiseHold,this._noiseDecay):this._noiseGain.gain.setTargetAtTime(0,i+this._noiseAttack+this._noiseHold,this._noiseDecay)},e}(),Q=function(e){function i(t,i){e.call(this,t,i),this.init(t)}return __extends(i,e),i.prototype.init=function(e){var i=t.context.currentTime+v.OSC_START_DELAY;this._sounds={};for(var n=0,s=e.sounds.length;s>n;n++){var r=e.sounds[n];switch(r.drum_type){case"SmattrKick1":this._sounds[r.note]=new R(r,i,this._output);break;case"SmattrKick2":this._sounds[r.note]=new U(r,i,this._output);break;case"SmattrSnare":this._sounds[r.note]=new B(r,i,this._output);break;case"SmattrHihat":this._sounds[r.note]=new H(r,i,this._output)}}},i.prototype.handleMidiEvent=function(e,i,n){if(i=i||t.context.currentTime,n=n||0,"channel"==e.type){var s=e.noteNumber;this._sounds[s]&&"noteOn"==e.subtype&&this._sounds[s].play(e.velocity,i)}return this},i.prototype.stop=function(t){t=t||v.now()},i.prototype.deschedule=function(){return this},i}(M);e.Smattr=Q,function(t){t._map=[],t._map[0]="Restart",t.Restart=0,t._map[1]="Playing",t.Playing=1,t._map[2]="All",t.All=2,t._map[3]="Continue",t.Continue=3}(e.SyncType||(e.SyncType={}));var K=e.SyncType,z=function(){function e(t,e){this._scheduler=null,this._started=!1,this._bpm=120,this._barLength=4,this._beatLength=1,this._resolution=.25,this._currentStep=0,this._paused=!1,this._name=e,this._type=t.type,this._bpm=t.bpm||120,this._barLength=t.bar_length||4,this._beatLength=t.beat_length||1,this._registeredPatterns=[],this._registeredSynths=[],this._syncHandler=new Y,this._syncedObjects=[],y.instance.pushToPreLoadInitStack(this)}return e.prototype.init=function(){this._lookahead=y.settings.sequencer_lookahead||50,this._scheduleAheadTime=y.settings.sequencer_schedule_ahead||.2,t.isIOS&&(this._scheduleAheadTime=y.settings.sequencer_schedule_ahead_ios||5),this._resolution=y.settings.sequencer_resolution||.25},e.prototype.startScheduler=function(){if(!this._paused&&0!==t.context.currentTime)for(this._lastScheduleLoopTime=t.context.currentTime;this._scheduleTime<t.context.currentTime+this._scheduleAheadTime;){for(var e=0,i=this._registeredPatterns.length;i>e;e++)this._registeredPatterns[e].update(this._currentStep,this._scheduleTime);for(var n=0,i=this._registeredSynths.length;i>n;n++)this._registeredSynths[n].update(this._currentStep,this._scheduleTime);this._currentStep+=this._resolution,this._scheduleTime+=60/this._bpm*this._resolution,this._syncHandler.update(this._resolution)}var s=this;this._scheduler=setTimeout(function(){s.startScheduler()},s._lookahead)},e.prototype.start=function(){return this._started=!0,this._scheduleTime=t.context.currentTime,.2>=this._scheduleAheadTime&&(this._scheduleTime+=.3),clearTimeout(this._scheduler),this.startScheduler(),this},e.prototype.pause=function(){this._paused=!0,this._pauseOffset=this._scheduleTime-v.now();for(var t=0,e=this._registeredPatterns.length;e>t;t++)this._registeredPatterns[t].pause();return this},e.prototype.unpause=function(){this._paused=!1,this._scheduleTime=v.now()+this._pauseOffset;for(var t=0,e=this._registeredPatterns.length;e>t;t++)this._registeredPatterns[t].unpause();return this},e.prototype.reschedule=function(){clearTimeout(this._scheduler);var e=this._scheduleTime-t.context.currentTime,i=this.getNoteTime(this._resolution),n=e>this._scheduleAheadTime?e-this._scheduleAheadTime:e-(this._scheduleAheadTime-i),s=(e-e%i)/i/(this._beatLength/this._resolution),r=this._scheduleAheadTime/i/(this._beatLength/this._resolution);this._scheduleTime=t.context.currentTime+n,r>s&&(this._scheduleTime-=i),this._currentStep-=r,(isNaN(this._currentStep)||0>this._currentStep)&&(this._currentStep=0);for(var o=0,a=this._registeredPatterns.length;a>o;o++)this._registeredPatterns[o].deschedule(r);return this.startScheduler(),this},e.prototype.stop=function(){return this._started=!1,clearTimeout(this._scheduler),this._scheduler=null,this._started=!1,this},e.prototype.stopAll=function(t){for(var e=[],i=0;arguments.length-1>i;i++)e[i]=arguments[i+1];for(var n=void 0!=t.beat?t.beat:4,s=t.fadeTime||1,r=t.forceFade||!1,o=t.wait||0,a=0,c=this._registeredPatterns.length;c>a;a++)-1==e.indexOf(this._registeredPatterns[a])&&(this._registeredPatterns[a].forceFade=r,this._registeredPatterns[a].stop(n,!0,s,o));return this},e.prototype.restart=function(){return this._currentStep=0,this},e.prototype.registerPattern=function(t){return this._registeredPatterns.push(t),this},e.prototype.unregisterPattern=function(t){var e=this._registeredPatterns.indexOf(t);return this._registeredPatterns.splice(e,1),this},e.prototype.registerSynth=function(t){return-1==this._registeredSynths.indexOf(t)&&this._registeredSynths.push(t),this},e.prototype.unregisterSynth=function(t){var e=this._registeredPatterns.indexOf(t);return this._registeredSynths.splice(e,1),this},e.prototype.sync=function(t,e,i){return this.syncInSteps(t,this.getStepsToNext(this.beatLength*e),i)},e.prototype.syncInSteps=function(t,e,i){this._started||this.start();var n=this.getNoteTime(e)+this._scheduleTime;return i?i.length&&i.push(n):i=[n],this._syncHandler.addSyncCountdown(new W(e,t,i)),this},e.prototype.syncPattern=function(e){for(var i=[],n=0;arguments.length-1>n;n++)i[n]=arguments[n+1];var s,r,o=e.beat,a=e.fadeIn||!1,c=e.duration||1,h=void 0==e.absolute?!1:e.absolute,u=void 0!=e.syncType?e.syncType:3,p=e.wait||0;this._started||(this._currentStep=0,this.start(),s=o=0,r=!0);var l,_=!1;if(u===K.Restart)l=0,_=!0;else if(u===K.Playing){for(var f=0,d=-1,g=0,y=i.length;y>g;g++)1===i[g].state&&i[g].length>f&&(f=i[g].length,d=g);var m=0;d>-1&&(m=i[d].getNextBar(o)),l=m*o,m>0&&p>0&&(l+=p)}else if(u===K.All){for(var f=0,d=-1,g=0,y=this._registeredPatterns.length;y>g;g++)(1===this._registeredPatterns[g].state||2===this._registeredPatterns[g].state)&&this._registeredPatterns[g].length>f&&(f=this._registeredPatterns[g].length,d=g);var v=0;d>-1&&(v=this._currentStep+this.getStepsToNext(o)),l=v}else u===K.Continue&&(l=0,_=r?!0:!1);0!=h?s="number"==typeof h?this.getStepsToNext(this.beatLength*h)+this.beatLength*o:this.beatLength*o:o>0?s=this.getStepsToNext(this.beatLength*o):0==o&&(s=0),p>0&&(s+=p);for(var g=0,y=i.length;y>g;g++)i[g].prePlaySchedule(s,l,_,a,c);if(r){var b=this._scheduleTime-t.context.currentTime,S=this.getNoteTime(this._resolution),T=b>this._scheduleAheadTime?b-this._scheduleAheadTime:b-(this._scheduleAheadTime-S);this._scheduleTime=t.context.currentTime+T,this._currentStep=_?i[0]._currentStep-this._resolution:i[0]._currentStep,r=!1}else this._scheduleAheadTime>.5&&this.reschedule();return this},e.prototype.registerBPMSync=function(t){return-1==this._syncedObjects.indexOf(t)&&this._syncedObjects.push(t),this},e.prototype.getStepsToNext=function(t){return t-this._currentStep%t},e.prototype.getNoteTime=function(t){return void 0==t&&(t=1),60/this._bpm*t},e.prototype.getBeatTime=function(t){return this.getNoteTime(this.getStepsToNext(t))+this._scheduleTime},Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bpm",{get:function(){return this._bpm},set:function(t){this._bpm=t;for(var e=0,i=this._registeredPatterns.length;i>e;e++)"MidiPattern"==this._registeredPatterns[e]._type&&this._registeredPatterns[e].recalculateBPM(this._bpm);for(var e=0,i=this._syncedObjects.length;i>e;e++)this._syncedObjects[e].updateSync(this._bpm)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{set:function(t){for(var e=0,i=this._registeredPatterns.length;i>e;e++)"MidiPattern"==this._registeredPatterns[e]._type&&(this._registeredPatterns[e].scale=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"customScale",{set:function(t){for(var e=0,i=this._registeredPatterns.length;i>e;e++)"MidiPattern"==this._registeredPatterns[e]._type&&(this._registeredPatterns[e].customScale=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transpose",{set:function(t){for(var e=0,i=this._registeredPatterns.length;i>e;e++)"MidiPattern"==this._registeredPatterns[e]._type&&(0===t?this._registeredPatterns[e].resetTranspose():this._registeredPatterns[e].transpose+=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barLength",{get:function(){return this._barLength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"beatLength",{get:function(){return this._beatLength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentStep",{get:function(){return this._currentStep},enumerable:!0,configurable:!0}),e}();e.Sequencer=z;var W=function(){function t(t,e,i){this._currentStep=0,this._targetStep=t,this._process=e,this._args=i}return t.prototype.advance=function(t){this._currentStep+=t},t.prototype.performAction=function(){"string"==typeof this._process?Function("Core","Model","Util","args",this._process)(y,e,v,this._args):this._process.start(this._args)},Object.defineProperty(t.prototype,"finished",{get:function(){return this._currentStep>=this._targetStep},enumerable:!0,configurable:!0}),t}();e.SyncCountdown=W;var Y=function(){function t(){this._timers=[]}return t.prototype.addSyncCountdown=function(t){this._timers.push(t)},t.prototype.update=function(t){for(var e=0;this._timers.length>e;e++){var i=this._timers[e];i.advance(t),i.finished&&(i.performAction(),this._timers.splice(e,1),e--)}},t}();e.SyncHandler=Y;var X=function(){function e(){this._updateTime=y.settings.timehandler_lookahead,this._callbacks=[]}return e.inst=null,Object.defineProperty(e,"instance",{get:function(){return null==e.inst&&(e.inst=new e),e.inst},enumerable:!0,configurable:!0}),e.prototype.startScheduler=function(){if(this._callbacks.length>0){for(var e=t.context.currentTime,i=e-this._lastTime,n=0;this._callbacks.length>n;n++){var s=this._callbacks[n];s.timePassed+=i,s.timePassed>=s.targetTime&&(s.obj[s.func](),this._callbacks.splice(n,1),n--)}this._lastTime=e;var r=this;this._scheduler=setTimeout(function(){r.startScheduler()},r._updateTime)}else this.stop()},e.prototype.start=function(){this._started=!0,this._lastTime=t.context.currentTime,clearTimeout(this._scheduler),this.startScheduler()},e.prototype.stop=function(){this._started=!1,clearTimeout(this._scheduler),this._scheduler=null},e.prototype.registerMethodCallback=function(t,e,i){this._callbacks.push({obj:t,func:e,timePassed:0,targetTime:i}),this._started||this.start()},e.prototype.removeMethodCallback=function(t,e){for(var i=0,n=this._callbacks.length;n>i;i++){var s=this._callbacks[i];if(s.obj==t&&s.func==e)return this._callbacks.splice(i,1),void 0}},e}();e.TimeHandler=X;var J=function(){function t(t){this._vars=t.vars,y.instance.pushToPreLoadInitStack(this)}return t.prototype.init=function(){for(var t=0,e=this._vars.length;e>t;t++){var i=this._vars[t];this._actionData[i]=y.instance.findInstance(i)}this._vars=null},t.prototype.start=function(){},t.prototype.execute=function(t,i,n){return(!this._func||n)&&(this._func=Function("Core","Model","Util","me","args",t)),this._func(y,e,v,this._actionData,i)},t}();e.Process=J;var $=function(e){function i(t,i){e.call(this,t),this._name=i,this._type=t.type,this._action=t.action,this._actionData={}}return __extends(i,e),i.prototype.start=function(e){try{this.execute(this._action,e)}catch(i){t.err("Klang: error in process '"+this._name+"': "+i.name+": "+i.message)}},i}(J);e.SimpleProcess=$;var Z=function(e){function i(t,i){e.call(this,t),this._nextStartTime=0,this._waitOffset=0,this.SCHEDULE_AHEAD_TIME=.2,this._lastTime=0,this._name=i,this._type=t.type,this._preAction=t.pre_action||null,this._actions=t.actions,this._currentAction=0,this._started=!1,this._loop=void 0!=t.loop?t.loop:!1,this._loopTime=t.loopTime||-1,this._actionData={process:this}}return __extends(i,e),i.prototype.start=function(e){if(!t.isIOS)try{if(this._args=e,this._currentAction=0,this._execTime=0,this._startTime=t.context.currentTime,this._nextStartTime=this._startTime,this._preAction)if("exec"==this._preAction.operation)this.execute(this._preAction.script,this._args);else if("wait"==this._preAction.operation)return this._execTime=this.execute(this._preAction.script,this._args),this._waitOffset+=this._execTime,this._execTime>=this.SCHEDULE_AHEAD_TIME?X.instance.registerMethodCallback(this,"cont",this._execTime-this.SCHEDULE_AHEAD_TIME/2):this.cont(),void 0;this._started=!0,this.cont()}catch(i){t.err("Klang: error in process '"+this._name+"': "+i.name+": "+i.message)}},i.prototype.cont=function(){this._actionData.execTime=this._nextStartTime+this._waitOffset;for(var t=this._actions.length;t>this._currentAction;this._currentAction++){if(!this._started)return;var e=this._actions[this._currentAction];if("exec"==e.operation)this.execute(e.script,this._args,!0),this._execTime=0;else if("wait"==e.operation)return this._execTime=this.execute(e.script,this._args,!0),this._waitOffset+=this._execTime,this._execTime>=this.SCHEDULE_AHEAD_TIME?X.instance.registerMethodCallback(this,"cont",this._execTime-this.SCHEDULE_AHEAD_TIME/2):this._waitOffset>this.SCHEDULE_AHEAD_TIME?this.scheduleLoop(this._waitOffset):(this._currentAction++,this.cont()),this._currentAction++,void 0}this._loop&&(this._loopTime>0?this.scheduleLoop(this._loopTime):(this._waitOffset=0,this._currentAction=0,this.cont()))},i.prototype.scheduleLoop=function(e){if(this._started){this._nextStartTime+=e;var i=this._nextStartTime-t.context.currentTime,n=this;setTimeout(function(){n._waitOffset=0,n._currentAction=0,n.cont()},1e3*(i-this.SCHEDULE_AHEAD_TIME/2))}},i.prototype.stop=function(){this._started=!1,X.instance.removeMethodCallback(this,"cont")},Object.defineProperty(i.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),i}(J);e.AdvancedProcess=Z})(m||(m={}));var v;(function(e){function i(e,i,n){e.setValueAtTime(i,n||t.context.currentTime)}function n(e,i,n){e.setValueAtTime(e.value+i,n||t.context.currentTime)}function s(e,i,n,s){s=s||t.context.currentTime,e.setValueAtTime(e.value,s),e.linearRampToValueAtTime(i,t.context.currentTime+n)}function r(i,n,s,r){r=r||t.context.currentTime,i.setValueAtTime(0==i.value?e.EXP_MIN_VALUE:i.value,r),i.exponentialRampToValueAtTime(n,t.context.currentTime+s)}function o(i,n,s,r){r=r||t.context.currentTime,i.setValueCurveAtTime(e.CUSTOM_CURVES[n],r,s)}function a(t){for(var i in t){var n=t[i];if(n instanceof Array)for(var s=new Float32Array(n.length),r=0,o=n.length;o>r;r++)s[r]=n[r];else{n.resolution||(n.resolution=1024),n.amplitude||(n.amplitude=1),n.amplitude_offset||(n.amplitude_offset=0),n.phase_offset||(n.phase_offset=0),n.length||(n.length=1);var s=new Float32Array(n.resolution);if("sine"==n.curve_type)for(var a=2*n.phase_offset*Math.PI,c=2*n.length*Math.PI,r=0,o=s.length;o>r;r++)s[r]=n.amplitude_offset+Math.sin(a+r/o*c)*n.amplitude;else if("saw"==n.curve_type)for(var r=0,o=s.length;o>r;r++)s[r]=n.amplitude_offset+(o-r)/o*n.amplitude;else if("inverse-saw"==n.curve_type)for(var r=0,o=s.length;o>r;r++)s[r]=n.amplitude_offset+r/o*n.amplitude;e.CUSTOM_CURVES[i]=s}}}function c(t,e){return Math.floor(e+(1+t-e)*Math.random())}function h(t,e){return e+(t-e)*Math.random()}function u(t,e,i){return i===void 0&&(i=3),t-(t-e)/i}function p(){return t.context.currentTime}function l(t){return 440*Math.pow(2,(t-69)/12)}function _(t){return 69+12*Math.log(t/440)/Math.log(2)}function f(e){if(void 0==e)return t.safari?0:"lowpass";if("Firefox"==t.browser){if("number"!=typeof e)return e;switch(e){case 0:return"lowpass";case 1:return"highpass";case 2:return"bandpass";case 3:return"lowshelf";case 4:return"highshelf";case 5:return"peaking";case 6:return"notch";case 7:return"allpass";default:return"lowpass"}}else if(t.safari){if("string"!=typeof e)return e;switch(e){case"lowpass":return 0;case"highpass":return 1;case"bandbass":return 2;case"lowshelf":return 3;case"highshelf":return 4;case"peaking":return 5;case"notch":return 6;case"allpass":return 7;default:return 0}}return e}function d(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function g(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}function m(t){y.instance.blurFadeOut=t}function v(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function b(){for(var t=[],e=0;arguments.length-0>e;e++)t[e]=arguments[e+0];for(var i=[{beat:0,fadeOut:2}],n=t.length-1;n>=0;n--){var s=y.instance.findInstance(t[n]);"Pattern"==s.type&&i.push(t[n])}var r=y.instance._objectTable;for(var o in y.instance._objectTable){var a=r[o];"AudioSource"==a._type&&-1==t.indexOf(o)?a.loop&&a.playing&&a.fadeOutAndStop(1):"Sequencer"==a._type?a.stopAll.apply(a,i):"AdvancedProcess"==a._type&&a.started&&-1==t.indexOf(o)&&a.stop()}}function S(t){for(var e,i,n=t.length;n--;)i=0|Math.random()*n,e=t[n],t[n]=t[i],t[i]=e;return t}if(e.setParam=i,e.adjustParam=n,e.curveParamLin=s,e.curveParamExp=r,e.curveParam=o,e.CUSTOM_CURVES={},e.createCurves=a,-1!=navigator.userAgent.indexOf("MSIE")){var T,O=navigator.userAgent,P=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=P.exec(O)&&(T=parseInt(RegExp.$1)),9>T&&(Object.defineProperty=Object.oldDefineProperty,delete Object.oldDefineProperty)}e.ROOT12=1.059463094359295,e.NYQUIST_FREQUENCY=22050,e.PITCH_SHIFT_FFT=2048,e.EXP_MIN_VALUE=1e-4,e.OSC_START_DELAY=.005,e.LOG_TIME_COLOR="#999999",e.LOG_EVENT_COLOR="#54CBDD",e.LOG_UNIMPLEMENTED_EVENT_COLOR="#E075A9",e.LOG_LOAD_COLOR="#333333",e.LOG_WARN_COLOR="DarkOrange",e.LOG_ERROR_COLOR="Red",e.lastEvent=void 0,e.vars={},e.random=c,e.randomFloat=h,e.ease=u,e.now=p,e.midiNoteToFrequency=l,e.frequencyToMidiNote=_,e.safeFilterType=f,e.checkMobile=d,e.checkIOS=g,e.setBlurFadeOut=m,e.getParameterByName=v,e.stopPlayingExcept=b,e.shuffle=S})(v||(v={}))})(Klang||(Klang={}));
                                          
                                          
                                        